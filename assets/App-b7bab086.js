import{r as u,M as W,j as D,F as G,a as p,G as Te,C as q,S as se,U as Lt,b as Je,B as ve,V,c as ae,d as j,D as kt,e as Ht,f as Ut,g as Ft,W as X,h as P,R as Gt,N as ue,i as Vt,k as ne,l as $t,m as Ee,n as ht,L as _e,o as Se,p as jt,E as ge,q as ft,s as pt,t as de,u as je,P as vt,v as Wt,w as mt,x as gt,y as xt,z as ee,A as Me,T as Re,H as et,I as K,J as Ke,K as yt,O as Kt,Q as Xt,X as ce,Y as Zt,Z as Oe,_ as Ie,$ as Le,a0 as ke,a1 as qt,a2 as Yt,a3 as St,a4 as Xe,a5 as Qt,a6 as Jt,a7 as le,a8 as es,a9 as ts,aa as ss,ab as ns}from"./index-d890020e.js";let pe;function is(){var e;if(pe!==void 0)return pe;try{let t;const s=document.createElement("canvas");return pe=!!(window.WebGL2RenderingContext&&(t=s.getContext("webgl2"))),t&&((e=t.getExtension("WEBGL_lose_context"))==null||e.loseContext()),pe}catch{return pe=!1}}function rs(){let{setStepPosition:e,stepCount:t}=u.useContext(W);const s=()=>{t++,e(t)},n=()=>{t--,e(t)};return D(G,{children:[t>=1?p("button",{onClick:n,className:"btn",id:"nextStep",children:" ❮ Previous Step  "}):null,p("button",{onClick:s,className:"btn",id:"nextStep",children:"Next Step ❯ "})]})}function as(){const{setModelInOut:e,selectedParts:t}=u.useContext(W),[s,n]=u.useState(!1);return p(G,{children:p("button",{onClick:()=>{s==!1?(document.getElementById("partsOut").innerHTML="Assemble",n(!0),e(s),console.log(t)):s==!0&&(document.getElementById("partsOut").innerHTML="Explode",n(!1),e(s),console.log(t))},className:"btn",id:"partsOut",children:"Explode"})})}function os(){let e=[],t=new Te;const{modelProperties:s,visibleObj:n,currentStepModel:i,setClickedParts:r,selectedParts:a,partsInOut:l,currentModel:c,setCurrentPartsModel:h}=u.useContext(W),[v,y]=u.useState(null),[S,x]=u.useState(!1),C=u.useCallback(()=>{if(t=new Te,e=[],v){for(let E=0;E<c.children.length;E++)if(c.children[E].userData.name===v){const T=c.children[E].clone();t.add(T),e.push(c.children[E].userData.name)}r(e),h(t)}});u.useEffect(()=>{e=[],r(e),C()},[i,v]),u.useEffect(()=>{x(!1),e=[],r(e),h(null)},[i]);const B=()=>{S===!0&&(x(!1),e=[],r(e),h(null)),S===!1&&(x(!0),C())};return p(G,{children:p("div",{children:p("ul",{children:s?s.partsNames.map(([E,T],m)=>p("li",{children:T===v&&S===!0?D("button",{id:`${T}`,style:{backgroundColor:"#669999",color:"#ffffff"},onClick:()=>{B()},className:"parts",children:[D("b",{children:[" ",E,"x"]}),"  ",T]}):D("button",{id:`${T}`,onClick:()=>{y(T),B()},className:"parts",children:[D("b",{children:[" ",E,"x"]}),"  ",T]})},m)):null})})})}let ls=class{constructor(t,s={}){this.enabled=!0;const n=s.defaultThickness!==void 0?s.defaultThickness:.003,i=new q().fromArray(s.defaultColor!==void 0?s.defaultColor:[0,0,0]),r=s.defaultAlpha!==void 0?s.defaultAlpha:1,a=s.defaultKeepAlive!==void 0?s.defaultKeepAlive:!1,l={},c=60,h={},v={},y={outlineThickness:{value:n},outlineColor:{value:i},outlineAlpha:{value:r}},S=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","	float thickness = outlineThickness;","	const float ratio = 1.0;","	vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","	vec4 norm = normalize( pos - pos2 );","	return pos + norm * thickness * pos.w * ratio;","}","void main() {","	#include <uv_vertex>","	#include <beginnormal_vertex>","	#include <morphnormal_vertex>","	#include <skinbase_vertex>","	#include <skinnormal_vertex>","	#include <begin_vertex>","	#include <morphtarget_vertex>","	#include <skinning_vertex>","	#include <displacementmap_vertex>","	#include <project_vertex>","	vec3 outlineNormal = - objectNormal;","	gl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","	#include <logdepthbuf_vertex>","	#include <clipping_planes_vertex>","	#include <fog_vertex>","}"].join(`
`),x=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","	#include <clipping_planes_fragment>","	#include <logdepthbuf_fragment>","	gl_FragColor = vec4( outlineColor, outlineAlpha );","	#include <tonemapping_fragment>","	#include <encodings_fragment>","	#include <fog_fragment>","	#include <premultiplied_alpha_fragment>","}"].join(`
`);function C(){return new se({type:"OutlineEffect",uniforms:Lt.merge([Je.fog,Je.displacementmap,y]),vertexShader:S,fragmentShader:x,side:ve})}function B(o){let d=l[o.uuid];return d===void 0&&(d={material:C(),used:!0,keepAlive:a,count:0},l[o.uuid]=d),d.used=!0,d.material}function E(o){const d=B(o);return h[d.uuid]=o,U(d,o),d}function T(o){const d=o.geometry;let f=!1;return o.geometry!==void 0&&(d.isBufferGeometry?f=d.attributes.normal!==void 0:f=!0),o.isMesh===!0&&o.material!==void 0&&f===!0}function m(o){if(T(o)!==!1){if(Array.isArray(o.material))for(let d=0,f=o.material.length;d<f;d++)o.material[d]=E(o.material[d]);else o.material=E(o.material);v[o.uuid]=o.onBeforeRender,o.onBeforeRender=A}}function b(o){if(T(o)!==!1){if(Array.isArray(o.material))for(let d=0,f=o.material.length;d<f;d++)o.material[d]=h[o.material[d].uuid];else o.material=h[o.material.uuid];o.onBeforeRender=v[o.uuid]}}function A(o,d,f,N,O){const $=h[O.uuid];$!==void 0&&I(O,$)}function I(o,d){const f=d.userData.outlineParameters;o.uniforms.outlineAlpha.value=d.opacity,f!==void 0&&(f.thickness!==void 0&&(o.uniforms.outlineThickness.value=f.thickness),f.color!==void 0&&o.uniforms.outlineColor.value.fromArray(f.color),f.alpha!==void 0&&(o.uniforms.outlineAlpha.value=f.alpha)),d.displacementMap&&(o.uniforms.displacementMap.value=d.displacementMap,o.uniforms.displacementScale.value=d.displacementScale,o.uniforms.displacementBias.value=d.displacementBias)}function U(o,d){if(o.name==="invisible")return;const f=d.userData.outlineParameters;o.fog=d.fog,o.toneMapped=d.toneMapped,o.premultipliedAlpha=d.premultipliedAlpha,o.displacementMap=d.displacementMap,f!==void 0?(d.visible===!1?o.visible=!1:o.visible=f.visible!==void 0?f.visible:!0,o.transparent=f.alpha!==void 0&&f.alpha<1?!0:d.transparent,f.keepAlive!==void 0&&(l[d.uuid].keepAlive=f.keepAlive)):(o.transparent=d.transparent,o.visible=d.visible),(d.wireframe===!0||d.depthTest===!1)&&(o.visible=!1),d.clippingPlanes&&(o.clipping=!0,o.clippingPlanes=d.clippingPlanes,o.clipIntersection=d.clipIntersection,o.clipShadows=d.clipShadows),o.version=d.version}function k(){let o;o=Object.keys(h);for(let d=0,f=o.length;d<f;d++)h[o[d]]=void 0;o=Object.keys(v);for(let d=0,f=o.length;d<f;d++)v[o[d]]=void 0;o=Object.keys(l);for(let d=0,f=o.length;d<f;d++){const N=o[d];l[N].used===!1?(l[N].count++,l[N].keepAlive===!1&&l[N].count>c&&delete l[N]):(l[N].used=!1,l[N].count=0)}}this.render=function(o,d){if(this.enabled===!1){t.render(o,d);return}const f=t.autoClear;t.autoClear=this.autoClear,t.render(o,d),t.autoClear=f,this.renderOutline(o,d)},this.renderOutline=function(o,d){const f=t.autoClear,N=o.matrixWorldAutoUpdate,O=o.background,$=t.shadowMap.enabled;o.matrixWorldAutoUpdate=!1,o.background=null,t.autoClear=!1,t.shadowMap.enabled=!1,o.traverse(m),t.render(o,d),o.traverse(b),k(),o.matrixWorldAutoUpdate=N,o.background=O,t.autoClear=f,t.shadowMap.enabled=$},this.autoClear=t.autoClear,this.domElement=t.domElement,this.shadowMap=t.shadowMap,this.clear=function(o,d,f){t.clear(o,d,f)},this.getPixelRatio=function(){return t.getPixelRatio()},this.setPixelRatio=function(o){t.setPixelRatio(o)},this.getSize=function(o){return t.getSize(o)},this.setSize=function(o,d,f){t.setSize(o,d,f)},this.setViewport=function(o,d,f,N){t.setViewport(o,d,f,N)},this.setScissor=function(o,d,f,N){t.setScissor(o,d,f,N)},this.setScissorTest=function(o){t.setScissorTest(o)},this.setRenderTarget=function(o){t.setRenderTarget(o)}}};/**
 * postprocessing v6.35.3 build Sat Mar 30 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var He=1/1e3,cs=1e3,us=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*He}get fixedDelta(){return this._fixedDelta*He}set fixedDelta(e){this._fixedDelta=e*cs}get elapsed(){return this._elapsed*He}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},ds=new gt,Y=null;function hs(){if(Y===null){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);Y=new xt,Y.setAttribute!==void 0?(Y.setAttribute("position",new ee(e,3)),Y.setAttribute("uv",new ee(t,2))):(Y.addAttribute("position",new ee(e,3)),Y.addAttribute("uv",new ee(t,2)))}return Y}var Z=class bt{constructor(t="Pass",s=new Ee,n=ds){this.name=t,this.renderer=null,this.scene=s,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const s=this.fullscreenMaterial;s!==null&&(s.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let s=this.screen;s!==null?s.material=t:(s=new ht(hs(),t),s.frustumCulled=!1,this.scene===null&&(this.scene=new Ee),this.scene.add(s),this.screen=s)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,s=ne){}render(t,s,n,i,r){throw new Error("Render method not implemented!")}setSize(t,s){}initialize(t,s,n){}dispose(){for(const t of Object.keys(this)){const s=this[t];(s instanceof X||s instanceof Me||s instanceof Re||s instanceof bt)&&this[t].dispose()}}},fs=class extends Z{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,s,n,i){const r=e.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},ps=Number(mt.replace(/\D+/g,""));function Ze(e){return ps<154?e.replace("colorspace_fragment","encodings_fragment"):e}var vs=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,ms="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Tt=class extends se{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new P(null),opacity:new P(1)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:vs,vertexShader:ms}),this.fragmentShader=Ze(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},gs=class extends Z{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Tt,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new X(1,1,{minFilter:_e,magFilter:_e,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,s,n,i){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTarget.texture.type=s,s!==ae?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e!==null&&e.outputColorSpace===j&&(this.renderTarget.texture.colorSpace=j))}},tt=new q,qe=class extends Z{constructor(e=!0,t=!0,s=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=s,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,s){this.color=e,this.depth=t,this.stencil=s}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,s,n,i){const r=this.overrideClearColor,a=this.overrideClearAlpha,l=e.getClearAlpha(),c=r!==null,h=a>=0;c?(e.getClearColor(tt),e.setClearColor(r,h?a:l)):h&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),c?e.setClearColor(tt,l):h&&e.setClearAlpha(l)}},xs=class extends Z{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new qe(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,s,n,i){const r=e.getContext(),a=e.state.buffers,l=this.scene,c=this.camera,h=this.clearPass,v=this.inverted?0:1,y=1-v;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),a.stencil.setFunc(r.ALWAYS,v,4294967295),a.stencil.setClear(y),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,s))),this.renderToScreen?(e.setRenderTarget(null),e.render(l,c)):(e.setRenderTarget(t),e.render(l,c),e.setRenderTarget(s),e.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(r.EQUAL,1,4294967295),a.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),a.stencil.setLocked(!0)}},ys=class{constructor(t=null,{depthBuffer:s=!0,stencilBuffer:n=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(s,n,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new gs,this.depthTexture=null,this.passes=[],this.timer=new us,this.autoRenderToScreen=!0,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){const s=this.inputBuffer,n=this.multisampling;n>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(s.depthBuffer,s.stencilBuffer,s.texture.type,t),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,t!==null){const s=t.getSize(new V),n=t.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===ae&&t.outputColorSpace===j&&(this.inputBuffer.texture.colorSpace=j,this.outputBuffer.texture.colorSpace=j,this.inputBuffer.dispose(),this.outputBuffer.dispose()),t.autoClear=!1,this.setSize(s.width,s.height);for(const r of this.passes)r.initialize(t,n,i)}}replaceRenderer(t,s=!0){const n=this.renderer,i=n.domElement.parentNode;return this.setRenderer(t),s&&i!==null&&(i.removeChild(n.domElement),i.appendChild(t.domElement)),n}createDepthTexture(){const t=this.depthTexture=new kt;return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=Ht,t.type=Ut):t.type=Ft,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const t of this.passes)t.setDepthTexture(null)}}createBuffer(t,s,n,i){const r=this.renderer,a=r===null?new V:r.getDrawingBufferSize(new V),l={minFilter:_e,magFilter:_e,stencilBuffer:s,depthBuffer:t,type:n},c=new X(a.width,a.height,l);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),n===ae&&r!==null&&r.outputColorSpace===j&&(c.texture.colorSpace=j),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(t){for(const s of this.passes)s.mainScene=t}setMainCamera(t){for(const s of this.passes)s.mainCamera=t}addPass(t,s){const n=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new V),a=i.getContext().getContextAttributes().alpha,l=this.inputBuffer.texture.type;if(t.setRenderer(i),t.setSize(r.width,r.height),t.initialize(i,a,l),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),s!==void 0?n.splice(s,0,t):n.push(t),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(t of n)t.setDepthTexture(c)}else t.setDepthTexture(this.depthTexture)}removePass(t){const s=this.passes,n=s.indexOf(t);if(n!==-1&&s.splice(n,1).length>0){if(this.depthTexture!==null){const a=(c,h)=>c||h.needsDepthTexture;s.reduce(a,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===s.length&&(t.renderToScreen=!1,s.length>0&&(s[s.length-1].renderToScreen=!0))}}removeAllPasses(){const t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){const s=this.renderer,n=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,a=!1,l,c,h;t===void 0&&(this.timer.update(),t=this.timer.getDelta());for(const v of this.passes)v.enabled&&(v.render(s,i,r,t,a),v.needsSwap&&(a&&(n.renderToScreen=v.renderToScreen,l=s.getContext(),c=s.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),n.render(s,i,r,t,a),c.setFunc(l.EQUAL,1,4294967295)),h=i,i=r,r=h),v instanceof xs?a=!0:v instanceof fs&&(a=!1))}setSize(t,s,n){const i=this.renderer,r=i.getSize(new V);(t===void 0||s===void 0)&&(t=r.width,s=r.height),(r.width!==t||r.height!==s)&&i.setSize(t,s,n);const a=i.getDrawingBufferSize(new V);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height);for(const l of this.passes)l.setSize(a.width,a.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},re={NONE:0,DEPTH:1,CONVOLUTION:2},R={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Ss=class{constructor(){this.shaderParts=new Map([[R.FRAGMENT_HEAD,null],[R.FRAGMENT_MAIN_UV,null],[R.FRAGMENT_MAIN_IMAGE,null],[R.VERTEX_HEAD,null],[R.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=re.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=ft}},Ue=!1,st=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let s;if(t.material.flatShading)switch(t.material.side){case Se:s=this.materialsFlatShadedDoubleSide;break;case ve:s=this.materialsFlatShadedBackSide;break;default:s=this.materialsFlatShaded;break}else switch(t.material.side){case Se:s=this.materialsDoubleSide;break;case ve:s=this.materialsBackSide;break;default:s=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=s[2]:t.isInstancedMesh?t.material=s[1]:t.material=s[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof se))return e.clone();const t=e.uniforms,s=new Map;for(const i in t){const r=t[i].value;r.isRenderTargetTexture&&(t[i].value=null,s.set(i,r))}const n=e.clone();for(const i of s)t[i[0]].value=i[1],n.uniforms[i[0]].value=i[1];return n}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const s of t)s.uniforms=Object.assign({},e.uniforms),s.side=jt;t[2].skinning=!0,this.materialsBackSide=t.map(s=>{const n=this.cloneMaterial(s);return n.uniforms=Object.assign({},e.uniforms),n.side=ve,n}),this.materialsDoubleSide=t.map(s=>{const n=this.cloneMaterial(s);return n.uniforms=Object.assign({},e.uniforms),n.side=Se,n}),this.materialsFlatShaded=t.map(s=>{const n=this.cloneMaterial(s);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=t.map(s=>{const n=this.cloneMaterial(s);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=ve,n}),this.materialsFlatShadedDoubleSide=t.map(s=>{const n=this.cloneMaterial(s);return n.uniforms=Object.assign({},e.uniforms),n.flatShading=!0,n.side=Se,n})}}render(e,t,s){const n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Ue){const i=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,s);for(const r of i)r[0].material=r[1];this.meshCount!==i.size&&i.clear()}else{const i=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,s),t.overrideMaterial=i}e.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Ue}static set workaroundEnabled(e){Ue=e}},Q=-1,F=class extends ge{constructor(e,t=Q,s=Q,n=1){super(),this.resizable=e,this.baseSize=new V(1,1),this.preferredSize=new V(t,s),this.target=this.preferredSize,this.s=n,this.effectiveSize=new V,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,s=this.effectiveSize,n=this.scale;t.width!==Q?s.width=t.width:t.height!==Q?s.width=Math.round(t.height*(e.width/Math.max(e.height,1))):s.width=Math.round(e.width*n),t.height!==Q?s.height=t.height:t.width!==Q?s.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):s.height=Math.round(e.height*n)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(Q),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Q}},bs=class extends Set{constructor(t,s=10){super(),this.l=s,this.exclusive=!1,t!==void 0&&this.set(t)}get layer(){return this.l}set layer(t){const s=this.l;for(const n of this)n.layers.disable(s),n.layers.enable(t);this.l=t}getLayer(){return this.layer}setLayer(t){this.layer=t}isExclusive(){return this.exclusive}setExclusive(t){this.exclusive=t}clear(){const t=this.layer;for(const s of this)s.layers.disable(t);return super.clear()}set(t){this.clear();for(const s of t)this.add(s);return this}indexOf(t){return this.has(t)?0:-1}add(t){return this.exclusive?t.layers.set(this.layer):t.layers.enable(this.layer),super.add(t)}delete(t){return this.has(t)&&t.layers.disable(this.layer),super.delete(t)}toggle(t){let s;return this.has(t)?(this.delete(t),s=!1):(this.add(t),s=!0),s}setVisible(t){for(const s of this)t?s.layers.enable(0):s.layers.disable(0);return this}},_={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Ts="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Es="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",_s="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Cs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ws="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",As="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Ms="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Rs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Ps="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Bs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Ns="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Ds="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",zs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Os="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Is="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Ls="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",ks="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Hs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Us="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Fs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Gs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Vs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",$s="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",js="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Ws="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",Ks="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Xs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Zs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",qs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Ys="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Qs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Js="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",en=new Map([[_.ADD,Ts],[_.ALPHA,Es],[_.AVERAGE,_s],[_.COLOR,Cs],[_.COLOR_BURN,ws],[_.COLOR_DODGE,As],[_.DARKEN,Ms],[_.DIFFERENCE,Rs],[_.DIVIDE,Ps],[_.DST,null],[_.EXCLUSION,Bs],[_.HARD_LIGHT,Ns],[_.HARD_MIX,Ds],[_.HUE,zs],[_.INVERT,Os],[_.INVERT_RGB,Is],[_.LIGHTEN,Ls],[_.LINEAR_BURN,ks],[_.LINEAR_DODGE,Hs],[_.LINEAR_LIGHT,Us],[_.LUMINOSITY,Fs],[_.MULTIPLY,Gs],[_.NEGATION,Vs],[_.NORMAL,$s],[_.OVERLAY,js],[_.PIN_LIGHT,Ws],[_.REFLECT,Ks],[_.SATURATION,Xs],[_.SCREEN,Zs],[_.SOFT_LIGHT,qs],[_.SRC,Ys],[_.SUBTRACT,Qs],[_.VIVID_LIGHT,Js]]),tn=class extends ge{constructor(t,s=1){super(),this._blendFunction=t,this.opacity=new P(s)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return en.get(this.blendFunction)}},Ye={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},sn=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,nn="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",rn=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],an=class extends se{constructor(e=new et){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new P(null),texelSize:new P(new et),scale:new P(1),kernel:new P(0)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:sn,vertexShader:nn}),this.fragmentShader=Ze(this.fragmentShader),this.setTexelSize(e.x,e.y),this.kernelSize=Ye.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return rn[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const s=1/e,n=1/t;this.uniforms.texelSize.value.set(s,n,s*.5,n*.5)}},on=class extends Z{constructor({kernelSize:e=Ye.MEDIUM,resolutionScale:t=.5,width:s=F.AUTO_SIZE,height:n=F.AUTO_SIZE,resolutionX:i=s,resolutionY:r=n}={}){super("KawaseBlurPass"),this.renderTargetA=new X(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new F(this,i,r,t);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new an,this._blurMaterial.kernelSize=e,this.copyMaterial=new Tt}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,n,i){const r=this.scene,a=this.camera,l=this.renderTargetA,c=this.renderTargetB,h=this.blurMaterial,v=h.kernelSequence;let y=t;this.fullscreenMaterial=h;for(let S=0,x=v.length;S<x;++S){const C=S&1?c:l;h.kernel=v[S],h.inputBuffer=y.texture,e.setRenderTarget(C),e.render(r,a),y=C}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=y.texture,e.setRenderTarget(this.renderToScreen?null:s),e.render(r,a)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t);const n=s.width,i=s.height;this.renderTargetA.setSize(n,i),this.renderTargetB.setSize(n,i),this.blurMaterial.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTargetA.texture.type=s,this.renderTargetB.texture.type=s,s!==ae?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e!==null&&e.outputColorSpace===j&&(this.renderTargetA.texture.colorSpace=j,this.renderTargetB.texture.colorSpace=j))}static get AUTO_SIZE(){return F.AUTO_SIZE}},ln=class extends ge{constructor(t,s,{attributes:n=re.NONE,blendFunction:i=_.NORMAL,defines:r=new Map,uniforms:a=new Map,extensions:l=null,vertexShader:c=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=s,this.vertexShader=c,this.defines=r,this.uniforms=a,this.extensions=l,this.blendMode=new tn(i),this.blendMode.addEventListener("change",h=>this.setChanged()),this._inputColorSpace=ft,this._outputColorSpace=pt}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,s=ne){}update(t,s,n){}setSize(t,s){}initialize(t,s,n){}dispose(){for(const t of Object.keys(this)){const s=this[t];(s instanceof X||s instanceof Me||s instanceof Re||s instanceof Z)&&this[t].dispose()}}},cn=class extends Z{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.input=t}setInput(e){this.input=e}render(e,t,s,n,i){const r=this.fullscreenMaterial.uniforms;t!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=t.texture),e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}initialize(e,t,s){s!==void 0&&s!==ae&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Pe=class extends Z{constructor(e,t,s=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new qe,this.overrideMaterialManager=s===null?null:new st(s),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new st(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,s,n,i){const r=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,h=r.background,v=e.shadowMap.autoUpdate,y=this.renderToScreen?null:t;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(y),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,r,a):e.render(r,a),a.layers.mask=c,r.background=h,e.shadowMap.autoUpdate=v}},un=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,dn=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,hn=class extends se{constructor(e=null,t){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new P(null),cameraNear:new P(.3),cameraFar:new P(1e3)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:un,vertexShader:dn}),this.depthBuffer=e,this.depthPacking=je,this.copyCameraSettings(t)}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=je){this.depthBuffer=e,this.depthPacking=t}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof vt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},fn="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",pn="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",vn=class extends se{constructor(e=new V){super({name:"OutlineMaterial",uniforms:{inputBuffer:new P(null),texelSize:new P(new V)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:fn,vertexShader:pn}),this.uniforms.texelSize.value.set(e.x,e.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},mn=class extends Z{constructor(e,t,{renderTarget:s,resolutionScale:n=1,width:i=F.AUTO_SIZE,height:r=F.AUTO_SIZE,resolutionX:a=i,resolutionY:l=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Pe(e,t,new Wt({depthPacking:je}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const h=c.clearPass;h.overrideClearColor=new q(16777215),h.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new X(1,1,{minFilter:ue,magFilter:ue}),this.renderTarget.texture.name="DepthPass.Target");const v=this.resolution=new F(this,a,l,n);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,n,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}},gn=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,xn="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",yn=class extends ln{constructor(e,t,{blendFunction:s=_.SCREEN,patternTexture:n=null,patternScale:i=1,edgeStrength:r=1,pulseSpeed:a=0,visibleEdgeColor:l=16777215,hiddenEdgeColor:c=2230538,kernelSize:h=Ye.VERY_SMALL,blur:v=!1,xRay:y=!0,multisampling:S=0,resolutionScale:x=.5,width:C=F.AUTO_SIZE,height:B=F.AUTO_SIZE,resolutionX:E=C,resolutionY:T=B}={}){super("OutlineEffect",gn,{uniforms:new Map([["maskTexture",new P(null)],["edgeTexture",new P(null)],["edgeStrength",new P(r)],["visibleEdgeColor",new P(new q(l))],["hiddenEdgeColor",new P(new q(c))],["pulse",new P(1)],["patternScale",new P(i)],["patternTexture",new P(null)]])}),this.blendMode.addEventListener("change",I=>{this.blendMode.blendFunction===_.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=s,this.patternTexture=n,this.xRay=y,this.scene=e,this.camera=t,this.renderTargetMask=new X(1,1),this.renderTargetMask.samples=S,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new X(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new qe,this.clearPass.overrideClearColor=new q(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new mn(e,t),this.maskPass=new Pe(e,t,new hn(this.depthPass.texture,t));const m=this.maskPass.clearPass;m.overrideClearColor=new q(16777215),m.overrideClearAlpha=1,this.blurPass=new on({resolutionScale:x,resolutionX:E,resolutionY:T,kernelSize:h}),this.blurPass.enabled=v;const b=this.blurPass.resolution;b.addEventListener("change",I=>this.setSize(b.baseWidth,b.baseHeight)),this.outlinePass=new cn(new vn);const A=this.outlinePass.fullscreenMaterial;A.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new bs,this.selection.layer=10,this.pulseSpeed=a}set mainScene(e){this.scene=e,this.depthPass.mainScene=e,this.maskPass.mainScene=e}set mainCamera(e){this.camera=e,this.depthPass.mainCamera=e,this.maskPass.mainCamera=e,this.maskPass.overrideMaterial.copyCameraSettings(e)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(e){this.renderTargetMask.samples=e,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(e){this.uniforms.get("patternScale").value=e}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(e){this.uniforms.get("edgeStrength").value=e}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(e){this.uniforms.get("visibleEdgeColor").value=e}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(e){this.uniforms.get("hiddenEdgeColor").value=e}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(e){this.pulseSpeed=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get selectionLayer(){return this.selection.layer}set selectionLayer(e){this.selection.layer=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get blur(){return this.blurPass.enabled}set blur(e){this.blurPass.enabled=e}get xRay(){return this.defines.has("X_RAY")}set xRay(e){this.xRay!==e&&(e?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(e){this.xRay=e}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(e){e!==null?(e.wrapS=e.wrapT=Gt,this.defines.set("USE_PATTERN","1"),this.setVertexShader(xn)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=e,this.setChanged()}setPatternTexture(e){this.patternTexture=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}setSelection(e){return this.selection.set(e),this}clearSelection(){return this.selection.clear(),this}selectObject(e){return this.selection.add(e),this}deselectObject(e){return this.selection.delete(e),this}update(e,t,s){const n=this.scene,i=this.camera,r=this.selection,l=this.uniforms.get("pulse"),c=n.background,h=i.layers.mask;(this.forceUpdate||r.size>0)&&(n.background=null,l.value=1,this.pulseSpeed>0&&(l.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.time+=s,r.setVisible(!1),this.depthPass.render(e),r.setVisible(!0),i.layers.set(r.layer),this.maskPass.render(e,this.renderTargetMask),i.layers.mask=h,n.background=c,this.outlinePass.render(e,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(e,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=r.size>0}setSize(e,t){this.blurPass.setSize(e,t),this.renderTargetMask.setSize(e,t);const s=this.resolution;s.setBaseSize(e,t);const n=s.width,i=s.height;this.depthPass.setSize(n,i),this.renderTargetOutline.setSize(n,i),this.outlinePass.fullscreenMaterial.setSize(n,i)}initialize(e,t,s){this.blurPass.initialize(e,t,ae),s!==void 0&&(this.depthPass.initialize(e,t,s),this.maskPass.initialize(e,t,s),this.outlinePass.initialize(e,t,s))}},Sn=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,bn="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Tn=class extends se{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new P(null),normalBuffer:new P(null),texelSize:new P(new V)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Sn,vertexShader:bn})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ne){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,e!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},En=class extends Z{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:s=F.AUTO_SIZE,height:n=F.AUTO_SIZE,resolutionX:i=s,resolutionY:r=n}={}){super("DepthDownsamplingPass");const a=new Tn;a.normalBuffer=e,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new X(1,1,{minFilter:ue,magFilter:ue,depthBuffer:!1,type:Vt}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const l=this.resolution=new F(this,i,r,t);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=ne){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,s,n,i){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,s){const n=e.getContext();if(!(n.getExtension("EXT_color_buffer_float")||n.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},_n=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Cn="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",wn=class extends se{constructor(e,t,s,n,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:mt.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new P(null),depthBuffer:new P(null),resolution:new P(new V),texelSize:new P(new V),cameraNear:new P(.3),cameraFar:new P(1e3),aspect:new P(1),time:new P(0)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),e&&this.setShaderParts(e),t&&this.setDefines(t),s&&this.setUniforms(s),this.copyCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ne){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=_n.replace(R.FRAGMENT_HEAD,e.get(R.FRAGMENT_HEAD)||"").replace(R.FRAGMENT_MAIN_UV,e.get(R.FRAGMENT_MAIN_UV)||"").replace(R.FRAGMENT_MAIN_IMAGE,e.get(R.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Cn.replace(R.VERTEX_HEAD,e.get(R.VERTEX_HEAD)||"").replace(R.VERTEX_MAIN_SUPPORT,e.get(R.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=Ze(this.fragmentShader),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof vt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const s=this.uniforms;s.resolution.value.set(e,t),s.texelSize.value.set(1/e,1/t),s.aspect.value=e/t}static get Section(){return R}};function nt(e,t,s){for(const n of t){const i="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),r=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const a of s.entries())a[1]!==null&&s.set(a[0],a[1].replace(r,i))}}function An(e,t,s){let n=t.getFragmentShader(),i=t.getVertexShader();const r=n!==void 0&&/mainImage/.test(n),a=n!==void 0&&/mainUv/.test(n);if(s.attributes|=t.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(a&&s.attributes&re.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!r&&!a)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const l=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=s.shaderParts;let h=c.get(R.FRAGMENT_HEAD)||"",v=c.get(R.FRAGMENT_MAIN_UV)||"",y=c.get(R.FRAGMENT_MAIN_IMAGE)||"",S=c.get(R.VERTEX_HEAD)||"",x=c.get(R.VERTEX_MAIN_SUPPORT)||"";const C=new Set,B=new Set;if(a&&(v+=`	${e}MainUv(UV);
`,s.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const m=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);x+=`	${e}MainSupport(`,x+=m?`vUv);
`:`);
`;for(const b of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const A of b[1].split(/\s*,\s*/))s.varyings.add(A),C.add(A),B.add(A);for(const b of i.matchAll(l))B.add(b[1])}for(const m of n.matchAll(l))B.add(m[1]);for(const m of t.defines.keys())B.add(m.replace(/\([\w\s,]*\)/g,""));for(const m of t.uniforms.keys())B.add(m);B.delete("while"),B.delete("for"),B.delete("if"),t.uniforms.forEach((m,b)=>s.uniforms.set(e+b.charAt(0).toUpperCase()+b.slice(1),m)),t.defines.forEach((m,b)=>s.defines.set(e+b.charAt(0).toUpperCase()+b.slice(1),m));const E=new Map([["fragment",n],["vertex",i]]);nt(e,B,s.defines),nt(e,B,E),n=E.get("fragment"),i=E.get("vertex");const T=t.blendMode;if(s.blendModes.set(T.blendFunction,T),r){t.inputColorSpace!==null&&t.inputColorSpace!==s.colorSpace&&(y+=t.inputColorSpace===j?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==pt?s.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(s.colorSpace=t.inputColorSpace);const m=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;y+=`${e}MainImage(color0, UV, `,s.attributes&re.DEPTH&&m.test(n)&&(y+="depth, ",s.readDepth=!0),y+=`color1);
	`;const b=e+"BlendOpacity";s.uniforms.set(b,T.opacity),y+=`color0 = blend${T.blendFunction}(color0, color1, ${b});

	`,h+=`uniform float ${b};

`}if(h+=n+`
`,i!==null&&(S+=i+`
`),c.set(R.FRAGMENT_HEAD,h),c.set(R.FRAGMENT_MAIN_UV,v),c.set(R.FRAGMENT_MAIN_IMAGE,y),c.set(R.VERTEX_HEAD,S),c.set(R.VERTEX_MAIN_SUPPORT,x),t.extensions!==null)for(const m of t.extensions)s.extensions.add(m)}}var Mn=class extends Z{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new wn(null,null,null,e),this.listener=s=>this.handleEvent(s),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,s)=>s.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new Ss;let t=0;for(const a of this.effects)if(a.blendMode.blendFunction===_.DST)e.attributes|=a.getAttributes()&re.DEPTH;else{if(e.attributes&a.getAttributes()&re.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);An("e"+t++,a,e)}let s=e.shaderParts.get(R.FRAGMENT_HEAD),n=e.shaderParts.get(R.FRAGMENT_MAIN_IMAGE),i=e.shaderParts.get(R.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const a of e.blendModes.values())s+=a.getShaderCode().replace(r,`blend${a.blendFunction}`)+`
`;e.attributes&re.DEPTH?(e.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===j&&(n+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(R.FRAGMENT_HEAD,s),e.shaderParts.set(R.FRAGMENT_MAIN_IMAGE,n),e.shaderParts.set(R.FRAGMENT_MAIN_UV,i);for(const[a,l]of e.shaderParts)l!==null&&e.shaderParts.set(a,l.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=ne){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const s of this.effects)s.setDepthTexture(e,t)}render(e,t,s,n,i){for(const r of this.effects)r.update(e,t,n);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=n*this.timeScale,e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const s of this.effects)s.setSize(e,t)}initialize(e,t,s){this.renderer=e;for(const n of this.effects)n.initialize(e,t,s);this.updateMaterial(),s!==void 0&&s!==ae&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},Rn=class extends Z{constructor(e,t,{renderTarget:s,resolutionScale:n=1,width:i=F.AUTO_SIZE,height:r=F.AUTO_SIZE,resolutionX:a=i,resolutionY:l=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Pe(e,t,new $t);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const h=c.getClearPass();h.overrideClearColor=new q(7829503),h.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new X(1,1,{minFilter:ue,magFilter:ue}),this.renderTarget.texture.name="NormalPass.Target");const v=this.resolution=new F(this,a,l,n);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,n,i){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r,r)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}};const Pn=e=>!!e.current,it=e=>Pn(e)?e.current:e,Et=u.createContext(null),Bn=K.memo(u.forwardRef((e,t)=>{let{children:s,camera:n,scene:i,resolutionScale:r,enabled:a=!0,renderPriority:l=1,autoClear:c=!0,depthBuffer:h,disableNormalPass:v,stencilBuffer:y,multisampling:S=8,frameBufferType:x=Kt}=e;const{gl:C,scene:B,camera:E,size:T}=Ke();i=i||B,n=n||E;const[m,b,A]=u.useMemo(()=>{const k=is(),o=new ys(C,{depthBuffer:h,stencilBuffer:y,multisampling:S>0&&k?S:0,frameBufferType:x});o.addPass(new Pe(i,n));let d=null,f=null;return v||(f=new Rn(i,n),f.enabled=!1,o.addPass(f),r!==void 0&&k&&(d=new En({normalBuffer:f.texture,resolutionScale:r}),d.enabled=!1,o.addPass(d))),[o,f,d]},[n,C,h,y,S,x,i,v,r]);u.useEffect(()=>m==null?void 0:m.setSize(T.width,T.height),[m,T]),yt((k,o)=>{a&&(C.autoClear=c,m.render(o))},a?l:0);const I=u.useRef(null);u.useLayoutEffect(()=>{let k;return I.current&&I.current.__r3f&&m&&(k=new Mn(n,...I.current.__r3f.objects),k.renderToScreen=!0,m.addPass(k),b&&(b.enabled=!0),A&&(A.enabled=!0)),()=>{k&&(m==null||m.removePass(k)),b&&(b.enabled=!1),A&&(A.enabled=!1)}},[m,s,n,b,A]);const U=u.useMemo(()=>({composer:m,normalPass:b,downSamplingPass:A,resolutionScale:r,camera:n,scene:i}),[m,b,A,r,n,i]);return u.useImperativeHandle(t,()=>m,[m]),K.createElement(Et.Provider,{value:U},K.createElement("group",{ref:I},s))})),_t=u.createContext(null);function Nn(e){let{children:t,enabled:s=!0}=e;const[n,i]=u.useState([]),r=u.useMemo(()=>({selected:n,select:i,enabled:s}),[n,i,s]);return K.createElement(_t.Provider,{value:r},t)}const Dn=u.forwardRef(function(t,s){let{selection:n=[],selectionLayer:i=10,blendFunction:r,patternTexture:a,edgeStrength:l,pulseSpeed:c,visibleEdgeColor:h,hiddenEdgeColor:v,width:y,height:S,kernelSize:x,blur:C,xRay:B,...E}=t;const T=Ke(U=>U.invalidate),{scene:m,camera:b}=u.useContext(Et),A=u.useMemo(()=>new yn(m,b,{blendFunction:r,patternTexture:a,edgeStrength:l,pulseSpeed:c,visibleEdgeColor:h,hiddenEdgeColor:v,width:y,height:S,kernelSize:x,blur:C,xRay:B,...E}),[r,C,b,l,S,v,x,a,c,m,h,y,B]),I=u.useContext(_t);return u.useEffect(()=>{if(!I&&n)return A.selection.set(Array.isArray(n)?n.map(it):[it(n)]),T(),()=>{A.selection.clear(),T()}},[A,n,I]),u.useEffect(()=>{A.selectionLayer=i,T()},[A,i]),u.useRef(),u.useEffect(()=>{if(I&&I.enabled){var U;if((U=I.selected)!=null&&U.length)return A.selection.set(I.selected),T(),()=>{A.selection.clear(),T()}}},[I]),K.createElement("primitive",{ref:s,object:A})});/**
 * postprocessing v6.29.3 build Sun Jan 01 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */var w={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},zn={NONE:0,DEPTH:1,CONVOLUTION:2},On=new gt,J=null;function In(){if(J===null){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);J=new xt,J.setAttribute!==void 0?(J.setAttribute("position",new ee(e,3)),J.setAttribute("uv",new ee(t,2))):(J.addAttribute("position",new ee(e,3)),J.addAttribute("uv",new ee(t,2)))}return J}var Ct=class{constructor(e="Pass",t=new Ee,s=On){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new ht(In(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ee),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=ne){}render(e,t,s,n,i){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof X||t instanceof Me||t instanceof Re||t instanceof Ct)&&this[e].dispose()}}};new q;var Ln="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",kn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Hn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Un="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Fn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Gn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Vn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",$n="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",jn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Wn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Kn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Xn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Zn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",qn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Yn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Qn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Jn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",ei="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",ti="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ni="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",ii="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",ri="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",ai="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",oi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",li="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",ci="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",di="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",hi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",fi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",pi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",vi=new Map([[w.ADD,Ln],[w.ALPHA,kn],[w.AVERAGE,Hn],[w.COLOR,Un],[w.COLOR_BURN,Fn],[w.COLOR_DODGE,Gn],[w.DARKEN,Vn],[w.DIFFERENCE,$n],[w.DIVIDE,jn],[w.DST,null],[w.EXCLUSION,Wn],[w.HARD_LIGHT,Kn],[w.HARD_MIX,Xn],[w.HUE,Zn],[w.INVERT,qn],[w.INVERT_RGB,Yn],[w.LIGHTEN,Qn],[w.LINEAR_BURN,Jn],[w.LINEAR_DODGE,ei],[w.LINEAR_LIGHT,ti],[w.LUMINOSITY,si],[w.MULTIPLY,ni],[w.NEGATION,ii],[w.NORMAL,ri],[w.OVERLAY,ai],[w.PIN_LIGHT,oi],[w.REFLECT,li],[w.SATURATION,ci],[w.SCREEN,ui],[w.SOFT_LIGHT,di],[w.SRC,hi],[w.SUBTRACT,fi],[w.VIVID_LIGHT,pi]]),mi=class extends ge{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new P(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return vi.get(this.blendFunction)}},gi=class extends ge{constructor(e,t,{attributes:s=zn.NONE,blendFunction:n=w.NORMAL,defines:i=new Map,uniforms:r=new Map,extensions:a=null,vertexShader:l=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=l,this.defines=i,this.uniforms=r,this.extensions=a,this.blendMode=new mi(n),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Xt,this._outputColorSpace=null}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=ne){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof X||t instanceof Me||t instanceof Re||t instanceof Ct)&&this[e].dispose()}}};new ce;new Zt;new q;new ce;new ce;const xi=`
    void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor)
    {
        outputColor = vec4(uv, 1.0, 1.0);
    }
`;class yi extends gi{constructor(){super("HighlightEffect",xi,{})}}function Si(){return new yi,p(G,{})}qt({OutlineEffect:ls});const Fe=[],Ge=[];function bi({modelIn:e,modelOut:t,modelInCopy:s}){console.log("render count"),Ke();const n=u.useRef(),i=u.useRef();u.useRef(),u.useRef();let{stepCount:r,partsInOut:a,setVisibleModel:l,setCurrentStepObj:c,selectedParts:h,setCurrentObj:v,cameraPosition:y}=u.useContext(W);const[S,x]=u.useState(!1),[C,B]=u.useState(!1),[E,T]=u.useState(e),[m,b]=u.useState(s),A=new Oe({color:15461355}),I=new Oe({color:16711680,wireframe:!0}),U=new Oe({color:13754592});var k=new Ie({color:4210752,linewidth:10});const[o,d]=u.useState({partsNames:[],titleName:[E.scene.children[0].name===`${S[0]}`]}),f=["291_Prepare_the_Fillet_Profile"],N=[["091_Bed_Frame","092_Bed_Legs","093_Bed_Lamella"],["141_Preparing_the_X-axis_1","142_Preparing_the_X-axis_2","143_Preparing_the_X-axis_3"],["301_Prepare_Window_1","302_Prepare_the_Window_2"]],O=[];let $=[],ie=[];u.useEffect(()=>{a===!0?T(e):a===!1&&T(t),console.log("partsinout")},[a]),u.useEffect(()=>{E.scene.traverse(g=>{g.isObject3D&&!g.isMesh&&!g.isGroup&&(Fe.push(g.name),Ge.push(g.userData.name))}),Fe.sort(),x(Fe),Ge.sort(),B(Ge),m.traverse(g=>{if(g.isMesh){g.material=A,g.frustumCulled=!1;var L=new Ie({color:10921638,linewidth:10}),M=new Le(g.geometry,20),z=new ke(M,L);g.add(z),M.dispose(),g.geometry.dispose(),A.dispose()}})},[]);const he=f.some(g=>g.includes(S[r])),ye=N.some(g=>g.includes(S[r])),H=E.scene.getObjectByName(S[r]),Be=u.useCallback(()=>{c(H);let g=[],L=[];if(H)for(let M=0;M<n.current.children.length;M++)n.current.children[M].name===`${S[r]}`&&(n.current.children[M].traverse(z=>{z.isGroup&&De.push(z.userData.name),g=[...new Set(De)],L=g.map(fe=>[De.filter(ze=>ze===fe).length,fe]),z.isObject3D&&!z.isMesh&&!z.isGroup&&Qe.push(z.userData.name)}),d({...o,partsNames:L,titleName:Qe}))},[S,r]),Ne=u.useCallback(()=>{for(let g=r-1;g>=0;g--)for(let L=ie.length-1;L>=0;L--)if(S[g]===ie[L]){let M=m.getObjectByName(`${S[g]}`,!0);$.push(M)}}),Bt=u.useCallback(()=>{for(let M=0;M<N.length;M++){ie=N[M];for(let z=0;z<ie.length;z++)ie.some(ze=>ze.includes(S[r]))&&Ne()}let g=new Te,L=H.clone();g.add(L),$.filter(M=>N.some(z=>z.includes(M.name))).forEach(M=>{M.visible=!0;let z=M.clone();g.add(z)}),l(g)}),Nt=u.useCallback(()=>{for(let M=r-1;M>=0;M--){let z=m.getObjectByName(`${S[M]}`,!0);O.push(z)}let g=new Te,L=H.clone();g.add(L),O.filter(M=>!f.some(z=>z.includes(M.name))&&!N.some(z=>z.includes(M.name))).forEach(M=>{M.visible=!0;let z=M.clone();g.add(z)}),l(g)}),Dt=u.useCallback(()=>{for(let g=0;g<H.children.length;g++)H.children[g].traverse(L=>{if(L.isMesh&&h.includes(H.children[g].userData.name)){L.material=U;var M=new Ie({color:6723993,linewidth:50}),z=new Le(L.geometry,20),fe=new ke(z,M);L.add(fe),U.dispose(),z.dispose(),M.dispose()}})}),zt=u.useCallback(()=>{if(H){v(H);for(let g=0;g<E.scene.children.length;g++)E.scene.children[g].visible=!1;for(let g=0;g<m.children.length;g++)m.children[g].visible=!1;H.traverse(g=>{if(g.isMesh){g.material=A,A.color.set(16777215),g.frustumCulled=!1;var L=new Le(g.geometry,20),M=new ke(L,k);g.add(M),L.dispose(),A.dispose(),g.userData.name==="Curves"&&(g.material=I,I.dispose(),g.geometry.dispose()),g.geometry.dispose()}}),h&&Dt(),he?(console.log("exception"),H.visible=!0,l(H)):ye?(console.log("preparing step"),H.visible=!0,Bt()):(console.log("main building step"),H.visible=!0,Nt())}},[H,S,r,h]);u.useEffect(()=>{Be()},[S,r]),u.useEffect(()=>{zt()},[H,h]);const De=[],Qe=[],{setProperties:Ot}=u.useContext(W);Ot(o);const{setListOfStep:It}=u.useContext(W);return It(C),u.useState(null),console.log(y),p(G,{children:D(Nn,{children:[S?D(G,{children:[p("primitive",{ref:n,object:E.scene,scale:1.0001,"position-y":.01}),p("primitive",{ref:i,object:m,scale:1})]}):null,D(Bn,{multisampling:8,autoClear:!1,children:[p(Dn,{selection:h,blendFunction:w.ALPHA,selectionLayer:1,blur:!0,visibleEdgeColor:65280,hiddenEdgeColor:65280,edgeStrength:50,width:1e3,height:1e3,xRay:!0}),p(Si,{})]})]})})}function Ti(){const{modelProperties:e}=u.useContext(W);return p(G,{children:p("div",{children:e?e.titleName:null})})}function Ei(){const{stepList:e,setStepPosition:t,stepCount:s,currentStepName:n,modelProperties:i}=u.useContext(W);u.useState("stepNaviBtn");const[r,a]=u.useState();return e&&[...Array(e.length)],p("div",{children:p("ul",{children:e?e.map((l,c)=>p("li",{children:i&&l===i.titleName[0]?p("button",{id:`${l}`,style:{backgroundColor:"#000000",color:"#ffffff"},onClick:()=>{t(c)},className:"stepNaviBtn",children:l}):p("button",{id:`${l}`,style:{backgroundColor:r},onClick:()=>{t(c)},className:"stepNaviBtn",children:l})},c)):null})})}const _i=e=>(t,s,n)=>{const i=n.subscribe;return n.subscribe=(a,l,c)=>{let h=a;if(l){const v=(c==null?void 0:c.equalityFn)||Object.is;let y=a(n.getState());h=S=>{const x=a(S);if(!v(y,x)){const C=y;l(y=x,C)}},c!=null&&c.fireImmediately&&l(y,y)}return i(h)},e(t,s,n)},Ci=_i,te=Yt(Ci(e=>({blocksCount:3,cameraPositionTag:"zero",isVisible:"visible",resetCamera:()=>{e(()=>({cameraPositionTag:"initial"}))},freeControls:()=>{e(()=>({cameraPositionTag:"zero"}))},topCamera:()=>{e(t=>({cameraPosition:"top"}))},isNotVisibleToggle:()=>{e(()=>({isVisible:"hidden"}))},isVisibleToggle:()=>{e(()=>({isVisible:"visible"}))}})));function wi({cameraControlsRef:e}){let{visibleObj:t,modelProperties:s,selectedPartsModel:n,currentStepModel:i,setCamera:r}=u.useContext(W);const a=St(),l=te(c=>c.cameraPositionTag);u.useEffect(()=>{a.refresh(t).fit()},[i,l]),u.useEffect(()=>{n?a.refresh(n).fit():n||a.refresh(t).fit()},[n])}let We=1,wt=new Array;new Array;let Ve=new Array,be;Xe.get("https://sheets.googleapis.com/v4/spreadsheets/18hHq4XYLPYSN1Wc0RjY5zl5vCHoVVrlugpG-O7cULLw/values/Workbook?key=AIzaSyCqcO7MQv4dsj76ps3nNJnMwTT8Cvqv-eM").then(e=>{let t=e.data.values,s=new Array;for(const n of t)We>2&&n[1]!=""&&(wt.push(s),s=new Array),s.push(n),++We});function Ai(){let{stepCount:e}=u.useContext(W);return u.useEffect(()=>{be=new Array;for(const t of wt[e+1])t[10]!=""&&t[10]!=null&&(Ve=new Array,Ve.push(t[10]),be.push(Ve)),++We},[e]),p(G,{children:p("div",{children:p("ul",{children:be?be.map((t,s)=>D("li",{children:[" ",t]},s)):null})})})}/**
  * react-collapsed v4.1.2
  *
  * Copyright (c) 2019-2023, Rogin Farrer
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE.md file in the root directory of this source tree.
  *
  * @license MIT
  */var Mi=class extends Error{constructor(e){super(`react-collapsed: ${e}`)}},Ce=(...e)=>(e[0],`${e[1]}`,void 0);function At(e){const t=u.useRef(e);return u.useEffect(()=>{t.current=e}),u.useCallback((...s)=>{var n;return(n=t.current)==null?void 0:n.call(t,...s)},[])}function Ri(e,t,s){const[n,i]=u.useState(t),r=u.useRef(typeof e<"u"),a=r.current?e:n,l=At(s),c=u.useCallback(h=>{const y=typeof h=="function"?h(a):h;r.current||i(y),l==null||l(y)},[l,a]);return u.useEffect(()=>{Ce(!(r.current&&e==null),"`isExpanded` state is changing from controlled to uncontrolled. useCollapse should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled collapse for the lifetime of the component. Check the `isExpanded` prop."),Ce(!(!r.current&&e!=null),"`isExpanded` state is changing from uncontrolled to controlled. useCollapse should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled collapse for the lifetime of the component. Check the `isExpanded` prop.")},[e]),[a,c]}var Pi="(prefers-reduced-motion: reduce)";function Bi(){const[e,t]=u.useState(!1);return u.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const s=window.matchMedia(Pi);t(s.matches);const n=i=>{t(i.matches)};if(s.addEventListener)return s.addEventListener("change",n),()=>{s.removeEventListener("change",n)};if(s.addListener)return s.addListener(n),()=>{s.removeListener(n)}},[]),e}var Ni=Qt["useId".toString()]||(()=>{});function Di(){return Ni()??""}var zi=typeof window<"u"?u.useLayoutEffect:u.useEffect,$e=!1,Oi=0,rt=()=>++Oi;function Ii(e){const t=e||($e?rt():null),[s,n]=u.useState(t);return zi(()=>{s===null&&n(rt())},[]),u.useEffect(()=>{$e===!1&&($e=!0)},[]),s!=null?String(s):void 0}function Li(e){const t=Di(),s=Ii(e);return typeof e=="string"?e:typeof t=="string"?t:s}function ki(e,t){const s=performance.now(),n={};function i(){n.id=requestAnimationFrame(r=>{r-s>t?e():i()})}return i(),n}function at(e){e.id&&cancelAnimationFrame(e.id)}function ot(e){return e!=null&&e.current?e.current.scrollHeight:(Ce(!0,"Was not able to find a ref to the collapse element via `getCollapseProps`. Ensure that the element exposes its `ref` prop. If it exposes the ref prop under a different name (like `innerRef`), use the `refKey` property to change it. Example:\n\nconst collapseProps = getCollapseProps({refKey: 'innerRef'})"),0)}function Hi(e){if(!e||typeof e=="string")return 0;const t=e/36;return Math.round((4+15*t**.25+t/5)*10)}function Ui(e,t){if(e!=null)if(typeof e=="function")e(t);else try{e.current=t}catch{throw new Mi(`Cannot assign value "${t}" to ref "${e}"`)}}function lt(...e){return e.every(t=>t==null)?null:t=>{e.forEach(s=>{Ui(s,t)})}}function Fi(e){let t=s=>{};t=s=>{if(!(s!=null&&s.current))return;const{paddingTop:n,paddingBottom:i}=window.getComputedStyle(s.current);Ce(!(n&&n!=="0px"||i&&i!=="0px"),`Padding applied to the collapse element will cause the animation to break and not perform as expected. To fix, apply equivalent padding to the direct descendent of the collapse element. Example:

Before:   <div {...getCollapseProps({style: {padding: 10}})}>{children}</div>

After:   <div {...getCollapseProps()}>
             <div style={{padding: 10}}>
                 {children}
             </div>
          </div>`)},u.useEffect(()=>{t(e)},[e])}var Gi=typeof window>"u"?u.useEffect:u.useLayoutEffect;function Vi({duration:e,easing:t="cubic-bezier(0.4, 0, 0.2, 1)",onTransitionStateChange:s=()=>{},isExpanded:n,defaultExpanded:i=!1,hasDisabledAnimation:r,id:a,...l}={}){const c=At(s),h=Li(a?`${a}`:void 0),[v,y]=Ri(n,i),S=u.useRef(v),[x,C]=u.useState(!1),B=Bi(),E=r??B,T=u.useRef(),m=u.useRef(),b=u.useRef(null),[A,I]=u.useState(null);Fi(b);const U=`${l.collapsedHeight||0}px`;function k(o){if(!b.current)return;const d=b.current;for(const f in o){const N=o[f];N?d.style[f]=N:d.style.removeProperty(f)}}return Gi(()=>{if(!b.current||v===S.current)return;S.current=v;function d(O){return E?0:e??Hi(O)}const f=O=>`height ${d(O)}ms ${t}`,N=O=>{function $(){v?(k({height:"",overflow:"",transition:"",display:""}),c("expandEnd")):(k({transition:""}),c("collapseEnd")),C(!1)}m.current&&at(m.current),m.current=ki($,O)};return C(!0),v?T.current=requestAnimationFrame(()=>{c("expandStart"),k({display:"block",overflow:"hidden",height:U}),T.current=requestAnimationFrame(()=>{c("expanding");const O=ot(b);N(d(O)),b.current&&(b.current.style.transition=f(O),b.current.style.height=`${O}px`)})}):T.current=requestAnimationFrame(()=>{c("collapseStart");const O=ot(b);N(d(O)),k({transition:f(O),height:`${O}px`}),T.current=requestAnimationFrame(()=>{c("collapsing"),k({height:U,overflow:"hidden"})})}),()=>{T.current&&cancelAnimationFrame(T.current),m.current&&at(m.current)}},[v,U,E,e,t,c]),{isExpanded:v,setExpanded:y,getToggleProps(o){const{disabled:d,onClick:f,refKey:N,...O}={refKey:"ref",onClick(){},disabled:!1,...o},$=A?A.tagName==="BUTTON":void 0,ie=o==null?void 0:o[N||"ref"],he={id:`react-collapsed-toggle-${h}`,"aria-controls":`react-collapsed-panel-${h}`,"aria-expanded":v,onClick(Be){d||(f==null||f(Be),y(Ne=>!Ne))},[N||"ref"]:lt(ie,I)},ye={type:"button",disabled:d?!0:void 0},H={"aria-disabled":d?!0:void 0,role:"button",tabIndex:d?-1:0};return $===!1?{...he,...H,...O}:$===!0?{...he,...ye,...O}:{...he,...ye,...H,...O}},getCollapseProps(o){const{style:d,refKey:f}={refKey:"ref",style:{},...o},N=o==null?void 0:o[f||"ref"];return{id:`react-collapsed-panel-${h}`,"aria-hidden":!v,"aria-labelledby":`react-collapsed-toggle-${h}`,role:"region",...o,[f||"ref"]:lt(b,N),style:{boxSizing:"border-box",...!x&&!v?{display:U==="0px"?"none":"block",height:U,overflow:"hidden"}:{},...d}}}}}var Mt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ct=K.createContext&&K.createContext(Mt),$i=["attr","size","title"];function ji(e,t){if(e==null)return{};var s=Wi(e,t),n,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function Wi(e,t){if(e==null)return{};var s={},n=Object.keys(e),i,r;for(r=0;r<n.length;r++)i=n[r],!(t.indexOf(i)>=0)&&(s[i]=e[i]);return s}function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},we.apply(this,arguments)}function ut(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,n)}return s}function Ae(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ut(Object(s),!0).forEach(function(n){Ki(e,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ut(Object(s)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(s,n))})}return e}function Ki(e,t,s){return t=Xi(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Xi(e){var t=Zi(e,"string");return typeof t=="symbol"?t:String(t)}function Zi(e,t){if(typeof e!="object"||e===null)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var n=s.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Rt(e){return e&&e.map((t,s)=>K.createElement(t.tag,Ae({key:s},t.attr),Rt(t.child)))}function xe(e){return t=>K.createElement(qi,we({attr:Ae({},e.attr)},t),Rt(e.child))}function qi(e){var t=s=>{var{attr:n,size:i,title:r}=e,a=ji(e,$i),l=i||s.size||"1em",c;return s.className&&(c=s.className),e.className&&(c=(c?c+" ":"")+e.className),K.createElement("svg",we({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,n,a,{className:c,style:Ae(Ae({color:e.color||s.color},s.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),r&&K.createElement("title",null,r),e.children)};return ct!==void 0?K.createElement(ct.Consumer,null,s=>t(s)):t(Mt)}function dt(e){return xe({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"},child:[]},{tag:"path",attr:{d:"M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7-21.2 8.1-39.2 22.3-52.1 40.9-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0 1 30.9-44.8c59-22.7 97.1-74.7 97.1-132.5.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1 0 80 0 40 40 0 1 0-80 0z"},child:[]}]})(e)}function Yi(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m18.25 7.6-5.5-3.18a1.49 1.49 0 0 0-1.5 0L5.75 7.6c-.46.27-.75.76-.75 1.3v6.35c0 .54.29 1.03.75 1.3l5.5 3.18c.46.27 1.04.27 1.5 0l5.5-3.18c.46-.27.75-.76.75-1.3V8.9c0-.54-.29-1.03-.75-1.3zM7 14.96v-4.62l4 2.32v4.61l-4-2.31zm5-4.03L8 8.61l4-2.31 4 2.31-4 2.32zm1 6.34v-4.61l4-2.32v4.62l-4 2.31zM7 2H3.5C2.67 2 2 2.67 2 3.5V7h2V4h3V2zm10 0h3.5c.83 0 1.5.67 1.5 1.5V7h-2V4h-3V2zM7 22H3.5c-.83 0-1.5-.67-1.5-1.5V17h2v3h3v2zm10 0h3.5c.83 0 1.5-.67 1.5-1.5V17h-2v3h-3v2z"},child:[]}]})(e)}function Qi(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"},child:[]}]})(e)}function Ji(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M24 24H0V0h24v24z",opacity:".87"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"},child:[]}]})(e)}let me=1,Pt=new Array,oe=new Array;Xe.get("https://sheets.googleapis.com/v4/spreadsheets/18hHq4XYLPYSN1Wc0RjY5zl5vCHoVVrlugpG-O7cULLw/values/Workbook?key=AIzaSyCqcO7MQv4dsj76ps3nNJnMwTT8Cvqv-eM").then(e=>{let t=e.data.values,s=new Array;for(const n of t)me>2&&n[1]!=""&&(Pt.push(s),s=new Array),s.push(n),++me});function er(){const[e,t]=u.useState(),[s,n]=u.useState(),[i,r]=u.useState(),a=te(x=>x.isNotVisibleToggle),l=te(x=>x.isVisibleToggle);te(x=>x.isVisible);let{stepCount:c,howToData:h,setHowToWorkbook:v,setClickedPath:y,path:S}=u.useContext(W);return u.useEffect(()=>{let x=new Array;Xe.get("https://sheets.googleapis.com/v4/spreadsheets/1grTucZ2sqLgZ4AtJq8EkyO__kLg-pazRVl3sbLNMaIY/values/Blad1?key=AIzaSyCqcO7MQv4dsj76ps3nNJnMwTT8Cvqv-eM").then(C=>{let B=C.data.values,E=new Array,T=[];for(const m of B)me>0&&m[0]!=""?(E=new Array,E.push(m),x.push(E)):E.push(m),++me;v(x);for(const m of x)m[0]!=""&&(oe=new Array,oe.push(m[0][0],m[0][1]),T.push(oe));r(T)})},[]),u.useEffect(()=>{let x=new Array;for(const C of Pt[c+1])C[12]!=""&&C[12]!=null&&(oe=new Array,oe.push(C[12]),x.push(oe)),++me;t(x)},[c]),u.useEffect(()=>{let x=[];if(i!=null){for(const C of e)for(const B of i)B.includes(`${C}`)&&x.push(B);n(x),e.length===0?a():l()}},[i,e]),console.log(S),p(G,{children:p("div",{children:p("ul",{children:s?s.map((x,C)=>D("li",{children:[p(Jt,{to:`/HowTo/${x[0]}`,target:"_blank",rel:"noopener noreferrer",children:D("button",{type:"button",className:"stepNaviBtn",children:[x[0],". ",x[1]]})})," "]},C)):null})})})}function tr(){const e=u.useRef(),[t,s]=u.useState(!1),{getCollapseProps:n,getToggleProps:i}=Vi({isExpanded:t}),r=te(a=>a.isVisible);return D(G,{children:[p("button",{type:"button",...i({onClick:()=>s(a=>!a)}),className:t?"expanded":"btn",style:{position:"absolute",top:"20px",left:"20px",visibility:`${r}`},children:t?D(G,{children:[p(dt,{})," How To ",p(Qi,{})]}):D(G,{children:[p(dt,{})," How To ",p(Ji,{})]})}),p("div",{ref:e,className:"howToBoxContent",...n(),children:p(er,{})})]})}function sr(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"8",y2:"12"},child:[]},{tag:"line",attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"},child:[]}]})(e)}function nr(){let{visibleObj:e}=u.useContext(W);const t=te(l=>l.cameraPositionTag),s=te(l=>l.freeControls),n=St(),[i]=u.useState(()=>new ce),[r]=u.useState(()=>new ce),a=new ce(4,.5,8);return yt((l,c)=>{t==="initial"&&(i.lerp(a,.1),r.lerp([0,0,0],.1),l.camera.position.copy(i),l.camera.lookAt(r),s(),n.refresh(e).fit())}),p(G,{})}function dr(){const e=le("./Fabulaser_V3_All_In.glb"),t=le("./Fabulaser_V3_All_Out.glb"),s=u.useMemo(()=>e.scene.clone(),[e]);le.clear("./Fabulaser_V3_All_In.glb"),le.clear("./Fabulaser_V3_All_Out.glb");const n=te(r=>r.resetCamera);function i(){const{active:r,progress:a,errors:l,item:c,loaded:h,total:v}=ss();return D(Html,{center:!0,children:[a," % loaded"]})}return p(G,{children:D(u.Fragment,{children:[p("aside",{className:"stepNavi",children:p(Ei,{})}),D("section",{id:"currentStepArea",children:[D("nav",{className:"currentStepBar",children:[p("h2",{id:"stepTitleArea",children:p(Ti,{})}),D("div",{id:"stepControl",children:[p(rs,{}),"                        "]})]}),D("div",{className:"infoColumn",children:[p("div",{className:"stepPartsArea",children:p(os,{})}),D("div",{className:"stepRemarksArea",children:[D("div",{style:{margin:"auto",display:"inline",alignContent:"baseline"},children:[D("h3",{children:[" ",p(sr,{})," Remarks"]})," ",p("br",{})]}),p(Ai,{})]})]}),D("article",{className:"viewArea",children:[p(u.Suspense,{fallback:p(i,{}),children:D(es,{linear:!0,flat:!0,frameloop:"demand",camera:{fov:45,near:.1,far:1e3,position:[4,.5,8]},children:[p(ir,{}),p("color",{args:["#f5f5f5"],attach:"background"}),p("directionalLight",{position:[1,2,3],intensity:10}),p("ambientLight",{intensity:10}),D(ts,{clip:!0,observe:!0,damping:2,margin:.85,children:[p(bi,{modelIn:e,modelOut:t,modelInCopy:s}),p(wi,{})]}),p(nr,{})]})}),D("button",{className:"btn",style:{position:"absolute",bottom:"20px",left:"20px"},onClick:n,children:[p(Yi,{})," Reset Camera"]}),p(as,{}),p(tr,{})]}),p("div",{className:"backgroundLoad",children:D("p",{children:["Please wait a moment, ",p("br",{}),"the model is being prepared."]})})]})]})})}le.preload("./Fabulaser_V3_All_In.glb");le.preload("./Fabulaser_V3_All_Out.glb");function ir(){const e=u.useRef();return p(G,{children:p(ns,{ref:e,makeDefault:!0,enableDamping:!1,enableRotate:!0,minAzimuthAngle:1/0,maxAzimuthAngle:1/0,minPolarAngle:0,maxPolarAngle:1/0})})}export{dr as default};
//# sourceMappingURL=App-b7bab086.js.map
