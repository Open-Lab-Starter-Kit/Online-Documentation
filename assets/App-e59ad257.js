import{r as u,M as K,j as z,F as G,a as p,G as Te,C as q,S as ie,U as Ut,b as tt,B as ve,c as pt,W as Z,N as de,d as Ft,e as ne,f as oe,g as Gt,V,D as Vt,h as $t,i as jt,k as Wt,l as Y,m as vt,n as P,R as Kt,o as he,p as Ke,P as mt,q as gt,s as Ee,t as xt,L as _e,E as ge,u as Se,v as Xt,w as Zt,x as Ze,y as yt,z as st,A as St,H as te,I as Re,T as Pe,J as X,K as qe,O as qt,Q as bt,X as Yt,Y as Le,Z as ke,_ as He,$ as Ue,a0 as Qt,a1 as Jt,a2 as Tt,a3 as Ye,a4 as es,a5 as ts,a6 as ce,a7 as ss,a8 as is,a9 as ns,aa as rs}from"./index-d2023187.js";function as(){let{setStepPosition:e,stepCount:t}=u.useContext(K);const s=()=>{t++,e(t)},i=()=>{t--,e(t)};return z(G,{children:[t>=1?p("button",{onClick:i,className:"btn",id:"nextStep",children:" ❮ Previous Step  "}):null,p("button",{onClick:s,className:"btn",id:"nextStep",children:"Next Step ❯ "})]})}function os(){const{setModelInOut:e,selectedParts:t}=u.useContext(K),[s,i]=u.useState(!1);return p(G,{children:p("button",{onClick:()=>{s==!1?(document.getElementById("partsOut").innerHTML="Assemble",i(!0),e(s),console.log(t)):s==!0&&(document.getElementById("partsOut").innerHTML="Explode",i(!1),e(s),console.log(t))},className:"btn",id:"partsOut",children:"Explode"})})}function ls(){let e=[],t=new Te;const{modelProperties:s,visibleObj:i,currentStepModel:n,setClickedParts:r,selectedParts:a,partsInOut:l,currentModel:c,setCurrentPartsModel:h}=u.useContext(K),[v,y]=u.useState(null),[S,x]=u.useState(!1),C=u.useCallback(()=>{if(t=new Te,e=[],v){for(let E=0;E<c.children.length;E++)if(c.children[E].userData.name===v){const T=c.children[E].clone();t.add(T),e.push(c.children[E].userData.name)}r(e),h(t)}});u.useEffect(()=>{e=[],r(e),C()},[n,v]),u.useEffect(()=>{x(!1),e=[],r(e),h(null)},[n]);const B=()=>{S===!0&&(x(!1),e=[],r(e),h(null)),S===!1&&(x(!0),C())};return p(G,{children:p("div",{children:p("ul",{children:s?s.partsNames.map(([E,T],m)=>p("li",{children:T===v&&S===!0?z("button",{id:`${T}`,style:{backgroundColor:"#669999",color:"#ffffff"},onClick:()=>{B()},className:"parts",children:[z("b",{children:[" ",E,"x"]}),"  ",T]}):z("button",{id:`${T}`,onClick:()=>{y(T),B()},className:"parts",children:[z("b",{children:[" ",E,"x"]}),"  ",T]})},m)):null})})})}let cs=class{constructor(t,s={}){this.enabled=!0;const i=s.defaultThickness!==void 0?s.defaultThickness:.003,n=new q().fromArray(s.defaultColor!==void 0?s.defaultColor:[0,0,0]),r=s.defaultAlpha!==void 0?s.defaultAlpha:1,a=s.defaultKeepAlive!==void 0?s.defaultKeepAlive:!1,l={},c=60,h={},v={},y={outlineThickness:{value:i},outlineColor:{value:n},outlineAlpha:{value:r}},S=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","	float thickness = outlineThickness;","	const float ratio = 1.0;","	vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","	vec4 norm = normalize( pos - pos2 );","	return pos + norm * thickness * pos.w * ratio;","}","void main() {","	#include <uv_vertex>","	#include <beginnormal_vertex>","	#include <morphnormal_vertex>","	#include <skinbase_vertex>","	#include <skinnormal_vertex>","	#include <begin_vertex>","	#include <morphtarget_vertex>","	#include <skinning_vertex>","	#include <displacementmap_vertex>","	#include <project_vertex>","	vec3 outlineNormal = - objectNormal;","	gl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","	#include <logdepthbuf_vertex>","	#include <clipping_planes_vertex>","	#include <fog_vertex>","}"].join(`
`),x=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","	#include <clipping_planes_fragment>","	#include <logdepthbuf_fragment>","	gl_FragColor = vec4( outlineColor, outlineAlpha );","	#include <tonemapping_fragment>","	#include <encodings_fragment>","	#include <fog_fragment>","	#include <premultiplied_alpha_fragment>","}"].join(`
`);function C(){return new ie({type:"OutlineEffect",uniforms:Ut.merge([tt.fog,tt.displacementmap,y]),vertexShader:S,fragmentShader:x,side:ve})}function B(o){let d=l[o.uuid];return d===void 0&&(d={material:C(),used:!0,keepAlive:a,count:0},l[o.uuid]=d),d.used=!0,d.material}function E(o){const d=B(o);return h[d.uuid]=o,U(d,o),d}function T(o){const d=o.geometry;let f=!1;return o.geometry!==void 0&&(d.isBufferGeometry?f=d.attributes.normal!==void 0:f=!0),o.isMesh===!0&&o.material!==void 0&&f===!0}function m(o){if(T(o)!==!1){if(Array.isArray(o.material))for(let d=0,f=o.material.length;d<f;d++)o.material[d]=E(o.material[d]);else o.material=E(o.material);v[o.uuid]=o.onBeforeRender,o.onBeforeRender=A}}function b(o){if(T(o)!==!1){if(Array.isArray(o.material))for(let d=0,f=o.material.length;d<f;d++)o.material[d]=h[o.material[d].uuid];else o.material=h[o.material.uuid];o.onBeforeRender=v[o.uuid]}}function A(o,d,f,N,O){const W=h[O.uuid];W!==void 0&&I(O,W)}function I(o,d){const f=d.userData.outlineParameters;o.uniforms.outlineAlpha.value=d.opacity,f!==void 0&&(f.thickness!==void 0&&(o.uniforms.outlineThickness.value=f.thickness),f.color!==void 0&&o.uniforms.outlineColor.value.fromArray(f.color),f.alpha!==void 0&&(o.uniforms.outlineAlpha.value=f.alpha)),d.displacementMap&&(o.uniforms.displacementMap.value=d.displacementMap,o.uniforms.displacementScale.value=d.displacementScale,o.uniforms.displacementBias.value=d.displacementBias)}function U(o,d){if(o.name==="invisible")return;const f=d.userData.outlineParameters;o.fog=d.fog,o.toneMapped=d.toneMapped,o.premultipliedAlpha=d.premultipliedAlpha,o.displacementMap=d.displacementMap,f!==void 0?(d.visible===!1?o.visible=!1:o.visible=f.visible!==void 0?f.visible:!0,o.transparent=f.alpha!==void 0&&f.alpha<1?!0:d.transparent,f.keepAlive!==void 0&&(l[d.uuid].keepAlive=f.keepAlive)):(o.transparent=d.transparent,o.visible=d.visible),(d.wireframe===!0||d.depthTest===!1)&&(o.visible=!1),d.clippingPlanes&&(o.clipping=!0,o.clippingPlanes=d.clippingPlanes,o.clipIntersection=d.clipIntersection,o.clipShadows=d.clipShadows),o.version=d.version}function k(){let o;o=Object.keys(h);for(let d=0,f=o.length;d<f;d++)h[o[d]]=void 0;o=Object.keys(v);for(let d=0,f=o.length;d<f;d++)v[o[d]]=void 0;o=Object.keys(l);for(let d=0,f=o.length;d<f;d++){const N=o[d];l[N].used===!1?(l[N].count++,l[N].keepAlive===!1&&l[N].count>c&&delete l[N]):(l[N].used=!1,l[N].count=0)}}this.render=function(o,d){if(this.enabled===!1){t.render(o,d);return}const f=t.autoClear;t.autoClear=this.autoClear,t.render(o,d),t.autoClear=f,this.renderOutline(o,d)},this.renderOutline=function(o,d){const f=t.autoClear,N=o.matrixWorldAutoUpdate,O=o.background,W=t.shadowMap.enabled;o.matrixWorldAutoUpdate=!1,o.background=null,t.autoClear=!1,t.shadowMap.enabled=!1,o.traverse(m),t.render(o,d),o.traverse(b),k(),o.matrixWorldAutoUpdate=N,o.background=O,t.autoClear=f,t.shadowMap.enabled=W},this.autoClear=t.autoClear,this.domElement=t.domElement,this.shadowMap=t.shadowMap,this.clear=function(o,d,f){t.clear(o,d,f)},this.getPixelRatio=function(){return t.getPixelRatio()},this.setPixelRatio=function(o){t.setPixelRatio(o)},this.getSize=function(o){return t.getSize(o)},this.setSize=function(o,d,f){t.setSize(o,d,f)},this.setViewport=function(o,d,f,N){t.setViewport(o,d,f,N)},this.setScissor=function(o,d,f,N){t.setScissor(o,d,f,N)},this.setScissorTest=function(o){t.setScissorTest(o)},this.setRenderTarget=function(o){t.setRenderTarget(o)}}};/**
 * postprocessing v6.31.0 build Sun May 07 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */var us="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Et="",$="srgb",Be="srgb-linear",ds=Number(gt.replace(/\D+/g,"")),_t=ds>=152,hs=new Map([[Ze,Be],[yt,$]]),fs=new Map([[Be,Ze],[$,yt]]);function Ce(e){return e===null?null:_t?e.outputColorSpace:hs.get(e.outputEncoding)}function ue(e,t){e!==null&&(_t?e.colorSpace=t:e.encoding=fs.get(t))}var _={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},ae={NONE:0,DEPTH:1,CONVOLUTION:2},R={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Qe={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},ps=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
}`,vs="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",ms=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],gs=class extends ie{constructor(e=new st){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new P(null),texelSize:new P(new st),scale:new P(1),kernel:new P(0)},blending:he,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ps,vertexShader:vs}),this.setTexelSize(e.x,e.y),this.kernelSize=Qe.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return ms[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const s=1/e,i=1/t;this.uniforms.texelSize.value.set(s,i,s*.5,i*.5)}},xs=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
#include <dithering_fragment>
}`,Ct=class extends ie{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new P(null),opacity:new P(1)},blending:he,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:xs,vertexShader:us})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},ys=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,Ss=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,bs=class extends ie{constructor(e=null,t){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new P(null),cameraNear:new P(.3),cameraFar:new P(1e3)},blending:he,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ys,vertexShader:Ss}),this.depthBuffer=e,this.depthPacking=Ke,this.copyCameraSettings(t)}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ke){this.depthBuffer=e,this.depthPacking=t}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof mt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Ts=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[]=float[4](abs(c-samples[0]),abs(c-samples[1]),abs(c-samples[2]),abs(c-samples[3]));float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[]=float[4](readDepth(vUv0),readDepth(vUv1),readDepth(vUv2),readDepth(vUv3));int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[]=vec3[4](texture2D(normalBuffer,vUv0).rgb,texture2D(normalBuffer,vUv1).rgb,texture2D(normalBuffer,vUv2).rgb,texture2D(normalBuffer,vUv3).rgb);
#else
vec3 n[]=vec3[4](vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Es="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",_s=class extends ie{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new P(null),normalBuffer:new P(null),texelSize:new P(new V)},blending:he,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ts,vertexShader:Es})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ne){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,e!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Cs=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,ws="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",As=class extends ie{constructor(e,t,s,i,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:gt.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new P(null),depthBuffer:new P(null),resolution:new P(new V),texelSize:new P(new V),cameraNear:new P(.3),cameraFar:new P(1e3),aspect:new P(1),time:new P(0)},blending:he,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:n}),e&&this.setShaderParts(e),t&&this.setDefines(t),s&&this.setUniforms(s),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ne){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=Cs.replace(R.FRAGMENT_HEAD,e.get(R.FRAGMENT_HEAD)||"").replace(R.FRAGMENT_MAIN_UV,e.get(R.FRAGMENT_MAIN_UV)||"").replace(R.FRAGMENT_MAIN_IMAGE,e.get(R.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=ws.replace(R.VERTEX_HEAD,e.get(R.VERTEX_HEAD)||"").replace(R.VERTEX_MAIN_SUPPORT,e.get(R.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof mt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const s=this.uniforms;s.resolution.value.set(e,t),s.texelSize.value.set(1/e,1/t),s.aspect.value=e/t}static get Section(){return R}},Ms="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",Rs="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",Ps=class extends ie{constructor(e=new V){super({name:"OutlineMaterial",uniforms:{inputBuffer:new P(null),texelSize:new P(new V)},blending:he,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ms,vertexShader:Rs}),this.uniforms.texelSize.value.set(e.x,e.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Bs=new pt,Q=null;function Ns(){if(Q===null){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);Q=new St,Q.setAttribute!==void 0?(Q.setAttribute("position",new te(e,3)),Q.setAttribute("uv",new te(t,2))):(Q.addAttribute("position",new te(e,3)),Q.addAttribute("uv",new te(t,2)))}return Q}var j=class{constructor(t="Pass",s=new Ee,i=Bs){this.name=t,this.renderer=null,this.scene=s,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const s=this.fullscreenMaterial;s!==null&&(s.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let s=this.screen;s!==null?s.material=t:(s=new xt(Ns(),t),s.frustumCulled=!1,this.scene===null&&(this.scene=new Ee),this.scene.add(s),this.screen=s)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,s=ne){}render(t,s,i,n,r){throw new Error("Render method not implemented!")}setSize(t,s){}initialize(t,s,i){}dispose(){for(const t of Object.keys(this)){const s=this[t];(s instanceof Z||s instanceof Re||s instanceof Pe||s instanceof j)&&this[t].dispose()}}},zs=class extends j{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Ct,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Z(1,1,{minFilter:_e,magFilter:_e,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,s,i,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTarget.texture.type=s,s!==oe?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Ce(e)===$&&ue(this.renderTarget.texture,$))}},Ds=class extends j{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,s,i,n){const r=e.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},it=new q,Je=class extends j{constructor(e=!0,t=!0,s=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=s,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,s){this.color=e,this.depth=t,this.stencil=s}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,s,i,n){const r=this.overrideClearColor,a=this.overrideClearAlpha,l=e.getClearAlpha(),c=r!==null,h=a>=0;c?(e.getClearColor(it),e.setClearColor(r,h?a:l)):h&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),c?e.setClearColor(it,l):h&&e.setClearAlpha(l)}},J=-1,F=class extends ge{constructor(e,t=J,s=J,i=1){super(),this.resizable=e,this.baseSize=new V(1,1),this.preferredSize=new V(t,s),this.target=this.preferredSize,this.s=i,this.effectiveSize=new V,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,s=this.effectiveSize,i=this.scale;t.width!==J?s.width=t.width:t.height!==J?s.width=Math.round(t.height*(e.width/Math.max(e.height,1))):s.width=Math.round(e.width*i),t.height!==J?s.height=t.height:t.width!==J?s.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):s.height=Math.round(e.height*i)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(J),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return J}},Fe=!1,nt=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let s;if(t.material.flatShading)switch(t.material.side){case Se:s=this.materialsFlatShadedDoubleSide;break;case ve:s=this.materialsFlatShadedBackSide;break;default:s=this.materialsFlatShaded;break}else switch(t.material.side){case Se:s=this.materialsDoubleSide;break;case ve:s=this.materialsBackSide;break;default:s=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=s[2]:t.isInstancedMesh?t.material=s[1]:t.material=s[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof ie))return e.clone();const t=e.uniforms,s=new Map;for(const n in t){const r=t[n].value;r.isRenderTargetTexture&&(t[n].value=null,s.set(n,r))}const i=e.clone();for(const n of s)t[n[0]].value=n[1],i.uniforms[n[0]].value=n[1];return i}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const s of t)s.uniforms=Object.assign({},e.uniforms),s.side=Xt;t[2].skinning=!0,this.materialsBackSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.side=ve,i}),this.materialsDoubleSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.side=Se,i}),this.materialsFlatShaded=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=ve,i}),this.materialsFlatShadedDoubleSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=Se,i})}}render(e,t,s){const i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Fe){const n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,s);for(const r of n)r[0].material=r[1];this.meshCount!==n.size&&n.clear()}else{const n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,s),t.overrideMaterial=n}e.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Fe}static set workaroundEnabled(e){Fe=e}},Ne=class extends j{constructor(e,t,s=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new Je,this.overrideMaterialManager=s===null?null:new nt(s),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new nt(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,s,i,n){const r=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,h=r.background,v=e.shadowMap.autoUpdate,y=this.renderToScreen?null:t;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(y),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,r,a):e.render(r,a),a.layers.mask=c,r.background=h,e.shadowMap.autoUpdate=v}},Os=class extends j{constructor(e,t,{renderTarget:s,resolutionScale:i=1,width:n=F.AUTO_SIZE,height:r=F.AUTO_SIZE,resolutionX:a=n,resolutionY:l=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Ne(e,t,new Zt({depthPacking:Ke}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const h=c.getClearPass();h.overrideClearColor=new q(16777215),h.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Z(1,1,{minFilter:de,magFilter:de}),this.renderTarget.texture.name="DepthPass.Target");const v=this.resolution=new F(this,a,l,i);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}},Is=class extends j{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:s=F.AUTO_SIZE,height:i=F.AUTO_SIZE,resolutionX:n=s,resolutionY:r=i}={}){super("DepthDownsamplingPass");const a=new _s;a.normalBuffer=e,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Z(1,1,{minFilter:de,magFilter:de,depthBuffer:!1,type:Ft}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const l=this.resolution=new F(this,n,r,t);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=ne){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,s,i,n){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,s){const i=e.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function rt(e,t,s){for(const i of t){const n="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const a of s.entries())a[1]!==null&&s.set(a[0],a[1].replace(r,n))}}function Ls(e,t,s){let i=t.getFragmentShader(),n=t.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),a=i!==void 0&&/mainUv/.test(i);if(s.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(a&&s.attributes&ae.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!r&&!a)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const l=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=s.shaderParts;let h=c.get(R.FRAGMENT_HEAD)||"",v=c.get(R.FRAGMENT_MAIN_UV)||"",y=c.get(R.FRAGMENT_MAIN_IMAGE)||"",S=c.get(R.VERTEX_HEAD)||"",x=c.get(R.VERTEX_MAIN_SUPPORT)||"";const C=new Set,B=new Set;if(a&&(v+=`	${e}MainUv(UV);
`,s.uvTransformation=!0),n!==null&&/mainSupport/.test(n)){const m=/mainSupport *\([\w\s]*?uv\s*?\)/.test(n);x+=`	${e}MainSupport(`,x+=m?`vUv);
`:`);
`;for(const b of n.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const A of b[1].split(/\s*,\s*/))s.varyings.add(A),C.add(A),B.add(A);for(const b of n.matchAll(l))B.add(b[1])}for(const m of i.matchAll(l))B.add(m[1]);for(const m of t.defines.keys())B.add(m.replace(/\([\w\s,]*\)/g,""));for(const m of t.uniforms.keys())B.add(m);B.delete("while"),B.delete("for"),B.delete("if"),t.uniforms.forEach((m,b)=>s.uniforms.set(e+b.charAt(0).toUpperCase()+b.slice(1),m)),t.defines.forEach((m,b)=>s.defines.set(e+b.charAt(0).toUpperCase()+b.slice(1),m));const E=new Map([["fragment",i],["vertex",n]]);rt(e,B,s.defines),rt(e,B,E),i=E.get("fragment"),n=E.get("vertex");const T=t.blendMode;if(s.blendModes.set(T.blendFunction,T),r){t.inputColorSpace!==null&&t.inputColorSpace!==s.colorSpace&&(y+=t.inputColorSpace===$?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==Et?s.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(s.colorSpace=t.inputColorSpace);const m=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;y+=`${e}MainImage(color0, UV, `,s.attributes&ae.DEPTH&&m.test(i)&&(y+="depth, ",s.readDepth=!0),y+=`color1);
	`;const b=e+"BlendOpacity";s.uniforms.set(b,T.opacity),y+=`color0 = blend${T.blendFunction}(color0, color1, ${b});

	`,h+=`uniform float ${b};

`}if(h+=i+`
`,n!==null&&(S+=n+`
`),c.set(R.FRAGMENT_HEAD,h),c.set(R.FRAGMENT_MAIN_UV,v),c.set(R.FRAGMENT_MAIN_IMAGE,y),c.set(R.VERTEX_HEAD,S),c.set(R.VERTEX_MAIN_SUPPORT,x),t.extensions!==null)for(const m of t.extensions)s.extensions.add(m)}}var ks=class extends j{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new As(null,null,null,e),this.listener=s=>this.handleEvent(s),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,s)=>s.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new Ws;let t=0;for(const a of this.effects)if(a.blendMode.blendFunction===_.DST)e.attributes|=a.getAttributes()&ae.DEPTH;else{if(e.attributes&a.getAttributes()&ae.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);Ls("e"+t++,a,e)}let s=e.shaderParts.get(R.FRAGMENT_HEAD),i=e.shaderParts.get(R.FRAGMENT_MAIN_IMAGE),n=e.shaderParts.get(R.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const a of e.blendModes.values())s+=a.getShaderCode().replace(r,`blend${a.blendFunction}`)+`
`;e.attributes&ae.DEPTH?(e.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===$&&(i+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(n=`vec2 transformedUv = vUv;
`+n,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(R.FRAGMENT_HEAD,s),e.shaderParts.set(R.FRAGMENT_MAIN_IMAGE,i),e.shaderParts.set(R.FRAGMENT_MAIN_UV,n);for(const[a,l]of e.shaderParts)l!==null&&e.shaderParts.set(a,l.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=ne){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const s of this.effects)s.setDepthTexture(e,t)}render(e,t,s,i,n){for(const r of this.effects)r.update(e,t,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const s of this.effects)s.setSize(e,t)}initialize(e,t,s){this.renderer=e;for(const i of this.effects)i.initialize(e,t,s);this.updateMaterial(),s!==void 0&&s!==oe&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},Hs=class extends j{constructor({kernelSize:e=Qe.MEDIUM,resolutionScale:t=.5,width:s=F.AUTO_SIZE,height:i=F.AUTO_SIZE,resolutionX:n=s,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Z(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new F(this,n,r,t);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new gs,this._blurMaterial.kernelSize=e,this.copyMaterial=new Ct}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,i,n){const r=this.scene,a=this.camera,l=this.renderTargetA,c=this.renderTargetB,h=this.blurMaterial,v=h.kernelSequence;let y=t;this.fullscreenMaterial=h;for(let S=0,x=v.length;S<x;++S){const C=S&1?c:l;h.kernel=v[S],h.inputBuffer=y.texture,e.setRenderTarget(C),e.render(r,a),y=C}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=y.texture,e.setRenderTarget(this.renderToScreen?null:s),e.render(r,a)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t);const i=s.width,n=s.height;this.renderTargetA.setSize(i,n),this.renderTargetB.setSize(i,n),this.blurMaterial.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTargetA.texture.type=s,this.renderTargetB.texture.type=s,s!==oe?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Ce(e)===$&&(ue(this.renderTargetA.texture,$),ue(this.renderTargetB.texture,$)))}static get AUTO_SIZE(){return F.AUTO_SIZE}},Us=class extends j{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new Je(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,s,i,n){const r=e.getContext(),a=e.state.buffers,l=this.scene,c=this.camera,h=this.clearPass,v=this.inverted?0:1,y=1-v;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),a.stencil.setFunc(r.ALWAYS,v,4294967295),a.stencil.setClear(y),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,s))),this.renderToScreen?(e.setRenderTarget(null),e.render(l,c)):(e.setRenderTarget(t),e.render(l,c),e.setRenderTarget(s),e.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(r.EQUAL,1,4294967295),a.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),a.stencil.setLocked(!0)}},Fs=class extends j{constructor(e,t,{renderTarget:s,resolutionScale:i=1,width:n=F.AUTO_SIZE,height:r=F.AUTO_SIZE,resolutionX:a=n,resolutionY:l=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Ne(e,t,new Gt);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const h=c.getClearPass();h.overrideClearColor=new q(7829503),h.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Z(1,1,{minFilter:de,magFilter:de}),this.renderTarget.texture.name="NormalPass.Target");const v=this.resolution=new F(this,a,l,i);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,r,r)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}},Gs=class extends j{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.input=t}setInput(e){this.input=e}render(e,t,s,i,n){const r=this.fullscreenMaterial.uniforms;t!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=t.texture),e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}initialize(e,t,s){s!==void 0&&s!==oe&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Ge=1/1e3,Vs=1e3,$s=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Ge}get fixedDelta(){return this._fixedDelta*Ge}set fixedDelta(e){this._fixedDelta=e*Vs}get elapsed(){return this._elapsed*Ge}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},js=class{constructor(t=null,{depthBuffer:s=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(s,i,r,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new zs,this.depthTexture=null,this.passes=[],this.timer=new $s,this.autoRenderToScreen=!0,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){const s=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(s.depthBuffer,s.stencilBuffer,s.texture.type,t),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,t!==null){const s=t.getSize(new V),i=t.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===oe&&Ce(t)===$&&(ue(this.inputBuffer.texture,$),ue(this.outputBuffer.texture,$),this.inputBuffer.dispose(),this.outputBuffer.dispose()),t.autoClear=!1,this.setSize(s.width,s.height);for(const r of this.passes)r.initialize(t,i,n)}}replaceRenderer(t,s=!0){const i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(t),s&&n!==null&&(n.removeChild(i.domElement),n.appendChild(t.domElement)),i}createDepthTexture(){const t=this.depthTexture=new Vt;return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=$t,t.type=jt):t.type=Wt,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const t of this.passes)t.setDepthTexture(null)}}createBuffer(t,s,i,n){const r=this.renderer,a=r===null?new V:r.getDrawingBufferSize(new V),l={minFilter:_e,magFilter:_e,stencilBuffer:s,depthBuffer:t,type:i},c=new Z(a.width,a.height,l);return n>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=n),i===oe&&Ce(r)===$&&ue(c.texture,$),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(t){for(const s of this.passes)s.mainScene=t}setMainCamera(t){for(const s of this.passes)s.mainCamera=t}addPass(t,s){const i=this.passes,n=this.renderer,r=n.getDrawingBufferSize(new V),a=n.getContext().getContextAttributes().alpha,l=this.inputBuffer.texture.type;if(t.setRenderer(n),t.setSize(r.width,r.height),t.initialize(n,a,l),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),s!==void 0?i.splice(s,0,t):i.push(t),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(t of i)t.setDepthTexture(c)}else t.setDepthTexture(this.depthTexture)}removePass(t){const s=this.passes,i=s.indexOf(t);if(i!==-1&&s.splice(i,1).length>0){if(this.depthTexture!==null){const a=(c,h)=>c||h.needsDepthTexture;s.reduce(a,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===s.length&&(t.renderToScreen=!1,s.length>0&&(s[s.length-1].renderToScreen=!0))}}removeAllPasses(){const t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){const s=this.renderer,i=this.copyPass;let n=this.inputBuffer,r=this.outputBuffer,a=!1,l,c,h;t===void 0&&(this.timer.update(),t=this.timer.delta);for(const v of this.passes)v.enabled&&(v.render(s,n,r,t,a),v.needsSwap&&(a&&(i.renderToScreen=v.renderToScreen,l=s.getContext(),c=s.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(s,n,r,t,a),c.setFunc(l.EQUAL,1,4294967295)),h=n,n=r,r=h),v instanceof Us?a=!0:v instanceof Ds&&(a=!1))}setSize(t,s,i){const n=this.renderer,r=n.getSize(new V);(t===void 0||s===void 0)&&(t=r.width,s=r.height),(r.width!==t||r.height!==s)&&n.setSize(t,s,i);const a=n.getDrawingBufferSize(new V);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height);for(const l of this.passes)l.setSize(a.width,a.height)}reset(){const t=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=t}dispose(){for(const t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Ws=class{constructor(){this.shaderParts=new Map([[R.FRAGMENT_HEAD,null],[R.FRAGMENT_MAIN_UV,null],[R.FRAGMENT_MAIN_IMAGE,null],[R.VERTEX_HEAD,null],[R.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ae.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Be}},Ks=class extends Set{constructor(t,s=10){super(),this.l=s,this.exclusive=!1,t!==void 0&&this.set(t)}get layer(){return this.l}set layer(t){const s=this.l;for(const i of this)i.layers.disable(s),i.layers.enable(t);this.l=t}getLayer(){return this.layer}setLayer(t){this.layer=t}isExclusive(){return this.exclusive}setExclusive(t){this.exclusive=t}clear(){const t=this.layer;for(const s of this)s.layers.disable(t);return super.clear()}set(t){this.clear();for(const s of t)this.add(s);return this}indexOf(t){return this.has(t)?0:-1}add(t){return this.exclusive?t.layers.set(this.layer):t.layers.enable(this.layer),super.add(t)}delete(t){return this.has(t)&&t.layers.disable(this.layer),super.delete(t)}toggle(t){let s;return this.has(t)?(this.delete(t),s=!1):(this.add(t),s=!0),s}setVisible(t){for(const s of this)t?s.layers.enable(0):s.layers.disable(0);return this}},Xs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Zs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",qs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Ys="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Qs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Js="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",ei="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",ti="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",ii="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",ni="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",ri="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",ai="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",oi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",li="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",ci="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",di="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",hi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",fi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",pi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",vi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",mi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",gi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",xi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",yi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",bi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Ti="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Ei="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",_i="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Ci="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",wi=new Map([[_.ADD,Xs],[_.ALPHA,Zs],[_.AVERAGE,qs],[_.COLOR,Ys],[_.COLOR_BURN,Qs],[_.COLOR_DODGE,Js],[_.DARKEN,ei],[_.DIFFERENCE,ti],[_.DIVIDE,si],[_.DST,null],[_.EXCLUSION,ii],[_.HARD_LIGHT,ni],[_.HARD_MIX,ri],[_.HUE,ai],[_.INVERT,oi],[_.INVERT_RGB,li],[_.LIGHTEN,ci],[_.LINEAR_BURN,ui],[_.LINEAR_DODGE,di],[_.LINEAR_LIGHT,hi],[_.LUMINOSITY,fi],[_.MULTIPLY,pi],[_.NEGATION,vi],[_.NORMAL,mi],[_.OVERLAY,gi],[_.PIN_LIGHT,xi],[_.REFLECT,yi],[_.SATURATION,Si],[_.SCREEN,bi],[_.SOFT_LIGHT,Ti],[_.SRC,Ei],[_.SUBTRACT,_i],[_.VIVID_LIGHT,Ci]]),Ai=class extends ge{constructor(t,s=1){super(),this._blendFunction=t,this.opacity=new P(s)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return wi.get(this.blendFunction)}},Mi=class extends ge{constructor(t,s,{attributes:i=ae.NONE,blendFunction:n=_.NORMAL,defines:r=new Map,uniforms:a=new Map,extensions:l=null,vertexShader:c=null}={}){super(),this.name=t,this.renderer=null,this.attributes=i,this.fragmentShader=s,this.vertexShader=c,this.defines=r,this.uniforms=a,this.extensions=l,this.blendMode=new Ai(n),this.blendMode.addEventListener("change",h=>this.setChanged()),this._inputColorSpace=Be,this._outputColorSpace=Et}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,s=ne){}update(t,s,i){}setSize(t,s){}initialize(t,s,i){}dispose(){for(const t of Object.keys(this)){const s=this[t];(s instanceof Z||s instanceof Re||s instanceof Pe||s instanceof j)&&this[t].dispose()}}};new Y;new vt;new q;var Ri=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,Pi="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",Bi=class extends Mi{constructor(e,t,{blendFunction:s=_.SCREEN,patternTexture:i=null,patternScale:n=1,edgeStrength:r=1,pulseSpeed:a=0,visibleEdgeColor:l=16777215,hiddenEdgeColor:c=2230538,kernelSize:h=Qe.VERY_SMALL,blur:v=!1,xRay:y=!0,multisampling:S=0,resolutionScale:x=.5,width:C=F.AUTO_SIZE,height:B=F.AUTO_SIZE,resolutionX:E=C,resolutionY:T=B}={}){super("OutlineEffect",Ri,{uniforms:new Map([["maskTexture",new P(null)],["edgeTexture",new P(null)],["edgeStrength",new P(r)],["visibleEdgeColor",new P(new q(l))],["hiddenEdgeColor",new P(new q(c))],["pulse",new P(1)],["patternScale",new P(n)],["patternTexture",new P(null)]])}),this.blendMode.addEventListener("change",I=>{this.blendMode.blendFunction===_.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=s,this.patternTexture=i,this.xRay=y,this.scene=e,this.camera=t,this.renderTargetMask=new Z(1,1),this.renderTargetMask.samples=S,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new Z(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new Je,this.clearPass.overrideClearColor=new q(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new Os(e,t),this.maskPass=new Ne(e,t,new bs(this.depthPass.texture,t));const m=this.maskPass.clearPass;m.overrideClearColor=new q(16777215),m.overrideClearAlpha=1,this.blurPass=new Hs({resolutionScale:x,resolutionX:E,resolutionY:T,kernelSize:h}),this.blurPass.enabled=v;const b=this.blurPass.resolution;b.addEventListener("change",I=>this.setSize(b.baseWidth,b.baseHeight)),this.outlinePass=new Gs(new Ps);const A=this.outlinePass.fullscreenMaterial;A.inputBuffer=this.renderTargetMask.texture,this.time=0,this.active=!1,this.selection=new Ks,this.selection.layer=10,this.pulseSpeed=a}set mainScene(e){this.scene=e,this.depthPass.mainScene=e,this.maskPass.mainScene=e}set mainCamera(e){this.camera=e,this.depthPass.mainCamera=e,this.maskPass.mainCamera=e,this.maskPass.overrideMaterial.copyCameraSettings(e)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(e){this.renderTargetMask.samples=e,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(e){this.uniforms.get("patternScale").value=e}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(e){this.uniforms.get("edgeStrength").value=e}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(e){this.uniforms.get("visibleEdgeColor").value=e}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(e){this.uniforms.get("hiddenEdgeColor").value=e}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(e){this.pulseSpeed=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get selectionLayer(){return this.selection.layer}set selectionLayer(e){this.selection.layer=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get blur(){return this.blurPass.enabled}set blur(e){this.blurPass.enabled=e}get xRay(){return this.defines.has("X_RAY")}set xRay(e){this.xRay!==e&&(e?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(e){this.xRay=e}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(e){e!==null?(e.wrapS=e.wrapT=Kt,this.defines.set("USE_PATTERN","1"),this.setVertexShader(Pi)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=e,this.setChanged()}setPatternTexture(e){this.patternTexture=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}setSelection(e){return this.selection.set(e),this}clearSelection(){return this.selection.clear(),this}selectObject(e){return this.selection.add(e),this}deselectObject(e){return this.selection.delete(e),this}update(e,t,s){const i=this.scene,n=this.camera,r=this.selection,l=this.uniforms.get("pulse"),c=i.background,h=n.layers.mask;r.size>0?(i.background=null,l.value=1,this.pulseSpeed>0&&(l.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.active=!0,this.time+=s,r.setVisible(!1),this.depthPass.render(e),r.setVisible(!0),n.layers.set(r.layer),this.maskPass.render(e,this.renderTargetMask),n.layers.mask=h,i.background=c,this.outlinePass.render(e,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(e,this.renderTargetOutline,this.renderTargetOutline)):this.active&&(this.clearPass.render(e,this.renderTargetOutline),this.active=!1)}setSize(e,t){this.blurPass.setSize(e,t),this.renderTargetMask.setSize(e,t);const s=this.resolution;s.setBaseSize(e,t);const i=s.width,n=s.height;this.depthPass.setSize(i,n),this.renderTargetOutline.setSize(i,n),this.outlinePass.fullscreenMaterial.setSize(i,n)}initialize(e,t,s){this.blurPass.initialize(e,t,oe),s!==void 0&&(this.depthPass.initialize(e,t,s),this.maskPass.initialize(e,t,s),this.outlinePass.initialize(e,t,s))}};new Y;new Y;/**
 * postprocessing v6.29.3 build Sun Jan 01 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */var w={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Ni={NONE:0,DEPTH:1,CONVOLUTION:2},zi=new pt,ee=null;function Di(){if(ee===null){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);ee=new St,ee.setAttribute!==void 0?(ee.setAttribute("position",new te(e,3)),ee.setAttribute("uv",new te(t,2))):(ee.addAttribute("position",new te(e,3)),ee.addAttribute("uv",new te(t,2)))}return ee}var wt=class{constructor(e="Pass",t=new Ee,s=zi){this.name=e,this.renderer=null,this.scene=t,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new xt(Di(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ee),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=ne){}render(e,t,s,i,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Z||t instanceof Re||t instanceof Pe||t instanceof wt)&&this[e].dispose()}}};new q;var Oi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Ii="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Li="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",ki="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Hi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Fi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Gi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Vi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",$i="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",ji="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Wi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Ki="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Xi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Zi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",qi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Yi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Qi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Ji="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",en="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",tn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",sn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",nn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",rn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",an="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",on="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",ln="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",cn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",un="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",dn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",hn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",fn="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",pn=new Map([[w.ADD,Oi],[w.ALPHA,Ii],[w.AVERAGE,Li],[w.COLOR,ki],[w.COLOR_BURN,Hi],[w.COLOR_DODGE,Ui],[w.DARKEN,Fi],[w.DIFFERENCE,Gi],[w.DIVIDE,Vi],[w.DST,null],[w.EXCLUSION,$i],[w.HARD_LIGHT,ji],[w.HARD_MIX,Wi],[w.HUE,Ki],[w.INVERT,Xi],[w.INVERT_RGB,Zi],[w.LIGHTEN,qi],[w.LINEAR_BURN,Yi],[w.LINEAR_DODGE,Qi],[w.LINEAR_LIGHT,Ji],[w.LUMINOSITY,en],[w.MULTIPLY,tn],[w.NEGATION,sn],[w.NORMAL,nn],[w.OVERLAY,rn],[w.PIN_LIGHT,an],[w.REFLECT,on],[w.SATURATION,ln],[w.SCREEN,cn],[w.SOFT_LIGHT,un],[w.SRC,dn],[w.SUBTRACT,hn],[w.VIVID_LIGHT,fn]]),vn=class extends ge{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new P(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return pn.get(this.blendFunction)}},mn=class extends ge{constructor(e,t,{attributes:s=Ni.NONE,blendFunction:i=w.NORMAL,defines:n=new Map,uniforms:r=new Map,extensions:a=null,vertexShader:l=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=l,this.defines=n,this.uniforms=r,this.extensions=a,this.blendMode=new vn(i),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Ze,this._outputColorSpace=null}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=ne){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Z||t instanceof Re||t instanceof Pe||t instanceof wt)&&this[e].dispose()}}};new Y;new vt;new q;new Y;new Y;const gn=e=>!!e.current,at=e=>gn(e)?e.current:e,At=u.createContext(null),xn=X.memo(u.forwardRef((e,t)=>{let{children:s,camera:i,scene:n,resolutionScale:r,enabled:a=!0,renderPriority:l=1,autoClear:c=!0,depthBuffer:h,disableNormalPass:v,stencilBuffer:y,multisampling:S=8,frameBufferType:x=Yt}=e;const{gl:C,scene:B,camera:E,size:T}=qe();n=n||B,i=i||E;const[m,b,A]=u.useMemo(()=>{const k=qt(),o=new js(C,{depthBuffer:h,stencilBuffer:y,multisampling:S>0&&k?S:0,frameBufferType:x});o.addPass(new Ne(n,i));let d=null,f=null;return v||(f=new Fs(n,i),f.enabled=!1,o.addPass(f),r!==void 0&&k&&(d=new Is({normalBuffer:f.texture,resolutionScale:r}),d.enabled=!1,o.addPass(d))),[o,f,d]},[i,C,h,y,S,x,n,v,r]);u.useEffect(()=>m==null?void 0:m.setSize(T.width,T.height),[m,T]),bt((k,o)=>{a&&(C.autoClear=c,m.render(o))},a?l:0);const I=u.useRef(null);u.useLayoutEffect(()=>{let k;return I.current&&I.current.__r3f&&m&&(k=new ks(i,...I.current.__r3f.objects),k.renderToScreen=!0,m.addPass(k),b&&(b.enabled=!0),A&&(A.enabled=!0)),()=>{k&&(m==null||m.removePass(k)),b&&(b.enabled=!1),A&&(A.enabled=!1)}},[m,s,i,b,A]);const U=u.useMemo(()=>({composer:m,normalPass:b,downSamplingPass:A,resolutionScale:r,camera:i,scene:n}),[m,b,A,r,i,n]);return u.useImperativeHandle(t,()=>m,[m]),X.createElement(At.Provider,{value:U},X.createElement("group",{ref:I},s))})),Mt=u.createContext(null);function yn(e){let{children:t,enabled:s=!0}=e;const[i,n]=u.useState([]),r=u.useMemo(()=>({selected:i,select:n,enabled:s}),[i,n,s]);return X.createElement(Mt.Provider,{value:r},t)}const Sn=u.forwardRef(function(t,s){let{selection:i=[],selectionLayer:n=10,blendFunction:r,patternTexture:a,edgeStrength:l,pulseSpeed:c,visibleEdgeColor:h,hiddenEdgeColor:v,width:y,height:S,kernelSize:x,blur:C,xRay:B,...E}=t;const T=qe(U=>U.invalidate),{scene:m,camera:b}=u.useContext(At),A=u.useMemo(()=>new Bi(m,b,{blendFunction:r,patternTexture:a,edgeStrength:l,pulseSpeed:c,visibleEdgeColor:h,hiddenEdgeColor:v,width:y,height:S,kernelSize:x,blur:C,xRay:B,...E}),[r,C,b,l,S,v,x,a,c,m,h,y,B]),I=u.useContext(Mt);return u.useEffect(()=>{if(!I&&i)return A.selection.set(Array.isArray(i)?i.map(at):[at(i)]),T(),()=>{A.selection.clear(),T()}},[A,i,I]),u.useEffect(()=>{A.selectionLayer=n,T()},[A,n]),u.useRef(),u.useEffect(()=>{if(I&&I.enabled){var U;if((U=I.selected)!=null&&U.length)return A.selection.set(I.selected),T(),()=>{A.selection.clear(),T()}}},[I]),X.createElement("primitive",{ref:s,object:A})}),bn=`
    void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor)
    {
        outputColor = vec4(uv, 1.0, 1.0);
    }
`;class Tn extends mn{constructor(){super("HighlightEffect",bn,{})}}function En(){return new Tn,p(G,{})}Qt({OutlineEffect:cs});const Ve=[],$e=[];function _n({modelIn:e,modelOut:t,modelInCopy:s}){console.log("render count"),qe();const i=u.useRef(),n=u.useRef();u.useRef(),u.useRef();let{stepCount:r,partsInOut:a,setVisibleModel:l,setCurrentStepObj:c,selectedParts:h,setCurrentObj:v,cameraPosition:y}=u.useContext(K);const[S,x]=u.useState(!1),[C,B]=u.useState(!1),[E,T]=u.useState(e),[m,b]=u.useState(s),A=new Le({color:15461355}),I=new Le({color:16711680,wireframe:!0}),U=new Le({color:13754592});var k=new ke({color:4210752,linewidth:10});const[o,d]=u.useState({partsNames:[],titleName:[E.scene.children[0].name===`${S[0]}`]}),f=["291_Prepare_the_Fillet_Profile"],N=[["091_Bed_Frame","092_Bed_Legs","093_Bed_Lamella"],["141_Preparing_the_X-axis_1","142_Preparing_the_X-axis_2","143_Preparing_the_X-axis_3"],["301_Prepare_Window_1","302_Prepare_the_Window_2"]],O=[];let W=[],re=[];u.useEffect(()=>{a===!0?T(e):a===!1&&T(t),console.log("partsinout")},[a]),u.useEffect(()=>{E.scene.traverse(g=>{g.isObject3D&&!g.isMesh&&!g.isGroup&&(Ve.push(g.name),$e.push(g.userData.name))}),Ve.sort(),x(Ve),$e.sort(),B($e),m.traverse(g=>{if(g.isMesh){g.material=A,g.frustumCulled=!1;var L=new ke({color:10921638,linewidth:10}),M=new He(g.geometry,20),D=new Ue(M,L);g.add(D),M.dispose(),g.geometry.dispose(),A.dispose()}})},[]);const fe=f.some(g=>g.includes(S[r])),ye=N.some(g=>g.includes(S[r])),H=E.scene.getObjectByName(S[r]),ze=u.useCallback(()=>{c(H);let g=[],L=[];if(H)for(let M=0;M<i.current.children.length;M++)i.current.children[M].name===`${S[r]}`&&(i.current.children[M].traverse(D=>{D.isGroup&&Oe.push(D.userData.name),g=[...new Set(Oe)],L=g.map(pe=>[Oe.filter(Ie=>Ie===pe).length,pe]),D.isObject3D&&!D.isMesh&&!D.isGroup&&et.push(D.userData.name)}),d({...o,partsNames:L,titleName:et}))},[S,r]),De=u.useCallback(()=>{for(let g=r-1;g>=0;g--)for(let L=re.length-1;L>=0;L--)if(S[g]===re[L]){let M=m.getObjectByName(`${S[g]}`,!0);W.push(M)}}),Dt=u.useCallback(()=>{for(let M=0;M<N.length;M++){re=N[M];for(let D=0;D<re.length;D++)re.some(Ie=>Ie.includes(S[r]))&&De()}let g=new Te,L=H.clone();g.add(L),W.filter(M=>N.some(D=>D.includes(M.name))).forEach(M=>{M.visible=!0;let D=M.clone();g.add(D)}),l(g)}),Ot=u.useCallback(()=>{for(let M=r-1;M>=0;M--){let D=m.getObjectByName(`${S[M]}`,!0);O.push(D)}let g=new Te,L=H.clone();g.add(L),O.filter(M=>!f.some(D=>D.includes(M.name))&&!N.some(D=>D.includes(M.name))).forEach(M=>{M.visible=!0;let D=M.clone();g.add(D)}),l(g)}),It=u.useCallback(()=>{for(let g=0;g<H.children.length;g++)H.children[g].traverse(L=>{if(L.isMesh&&h.includes(H.children[g].userData.name)){L.material=U;var M=new ke({color:6723993,linewidth:50}),D=new He(L.geometry,20),pe=new Ue(D,M);L.add(pe),U.dispose(),D.dispose(),M.dispose()}})}),Lt=u.useCallback(()=>{if(H){v(H);for(let g=0;g<E.scene.children.length;g++)E.scene.children[g].visible=!1;for(let g=0;g<m.children.length;g++)m.children[g].visible=!1;H.traverse(g=>{if(g.isMesh){g.material=A,A.color.set(16777215),g.frustumCulled=!1;var L=new He(g.geometry,20),M=new Ue(L,k);g.add(M),L.dispose(),A.dispose(),g.userData.name==="Curves"&&(g.material=I,I.dispose(),g.geometry.dispose()),g.geometry.dispose()}}),h&&It(),fe?(console.log("exception"),H.visible=!0,l(H)):ye?(console.log("preparing step"),H.visible=!0,Dt()):(console.log("main building step"),H.visible=!0,Ot())}},[H,S,r,h]);u.useEffect(()=>{ze()},[S,r]),u.useEffect(()=>{Lt()},[H,h]);const Oe=[],et=[],{setProperties:kt}=u.useContext(K);kt(o);const{setListOfStep:Ht}=u.useContext(K);return Ht(C),u.useState(null),console.log(y),p(G,{children:z(yn,{children:[S?z(G,{children:[p("primitive",{ref:i,object:E.scene,scale:1.0001,"position-y":.01}),p("primitive",{ref:n,object:m,scale:1})]}):null,z(xn,{multisampling:8,autoClear:!1,children:[p(Sn,{selection:h,blendFunction:w.ALPHA,selectionLayer:1,blur:!0,visibleEdgeColor:65280,hiddenEdgeColor:65280,edgeStrength:50,width:1e3,height:1e3,xRay:!0}),p(En,{})]})]})})}function Cn(){const{modelProperties:e}=u.useContext(K);return p(G,{children:p("div",{children:e?e.titleName:null})})}function wn(){const{stepList:e,setStepPosition:t,stepCount:s,currentStepName:i,modelProperties:n}=u.useContext(K);u.useState("stepNaviBtn");const[r,a]=u.useState();return e&&[...Array(e.length)],p("div",{children:p("ul",{children:e?e.map((l,c)=>p("li",{children:n&&l===n.titleName[0]?p("button",{id:`${l}`,style:{backgroundColor:"#000000",color:"#ffffff"},onClick:()=>{t(c)},className:"stepNaviBtn",children:l}):p("button",{id:`${l}`,style:{backgroundColor:r},onClick:()=>{t(c)},className:"stepNaviBtn",children:l})},c)):null})})}const An=e=>(t,s,i)=>{const n=i.subscribe;return i.subscribe=(a,l,c)=>{let h=a;if(l){const v=(c==null?void 0:c.equalityFn)||Object.is;let y=a(i.getState());h=S=>{const x=a(S);if(!v(y,x)){const C=y;l(y=x,C)}},c!=null&&c.fireImmediately&&l(y,y)}return n(h)},e(t,s,i)},Mn=An,se=Jt(Mn(e=>({blocksCount:3,cameraPositionTag:"zero",isVisible:"visible",resetCamera:()=>{e(()=>({cameraPositionTag:"initial"}))},freeControls:()=>{e(()=>({cameraPositionTag:"zero"}))},topCamera:()=>{e(t=>({cameraPosition:"top"}))},isNotVisibleToggle:()=>{e(()=>({isVisible:"hidden"}))},isVisibleToggle:()=>{e(()=>({isVisible:"visible"}))}})));function Rn({cameraControlsRef:e}){let{visibleObj:t,modelProperties:s,selectedPartsModel:i,currentStepModel:n,setCamera:r}=u.useContext(K);const a=Tt(),l=se(c=>c.cameraPositionTag);u.useEffect(()=>{a.refresh(t).fit()},[n,l]),u.useEffect(()=>{i?a.refresh(i).fit():i||a.refresh(t).fit()},[i])}let Xe=1,Rt=new Array;new Array;let je=new Array,be;Ye.get("https://sheets.googleapis.com/v4/spreadsheets/18hHq4XYLPYSN1Wc0RjY5zl5vCHoVVrlugpG-O7cULLw/values/Workbook?key=AIzaSyCqcO7MQv4dsj76ps3nNJnMwTT8Cvqv-eM").then(e=>{let t=e.data.values,s=new Array;for(const i of t)Xe>2&&i[1]!=""&&(Rt.push(s),s=new Array),s.push(i),++Xe});function Pn(){let{stepCount:e}=u.useContext(K);return u.useEffect(()=>{be=new Array;for(const t of Rt[e+1])t[10]!=""&&t[10]!=null&&(je=new Array,je.push(t[10]),be.push(je)),++Xe},[e]),p(G,{children:p("div",{children:p("ul",{children:be?be.map((t,s)=>z("li",{children:[" ",t]},s)):null})})})}/**
  * react-collapsed v4.1.2
  *
  * Copyright (c) 2019-2023, Rogin Farrer
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE.md file in the root directory of this source tree.
  *
  * @license MIT
  */var Bn=class extends Error{constructor(e){super(`react-collapsed: ${e}`)}},we=(...e)=>(e[0],`${e[1]}`,void 0);function Pt(e){const t=u.useRef(e);return u.useEffect(()=>{t.current=e}),u.useCallback((...s)=>{var i;return(i=t.current)==null?void 0:i.call(t,...s)},[])}function Nn(e,t,s){const[i,n]=u.useState(t),r=u.useRef(typeof e<"u"),a=r.current?e:i,l=Pt(s),c=u.useCallback(h=>{const y=typeof h=="function"?h(a):h;r.current||n(y),l==null||l(y)},[l,a]);return u.useEffect(()=>{we(!(r.current&&e==null),"`isExpanded` state is changing from controlled to uncontrolled. useCollapse should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled collapse for the lifetime of the component. Check the `isExpanded` prop."),we(!(!r.current&&e!=null),"`isExpanded` state is changing from uncontrolled to controlled. useCollapse should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled collapse for the lifetime of the component. Check the `isExpanded` prop.")},[e]),[a,c]}var zn="(prefers-reduced-motion: reduce)";function Dn(){const[e,t]=u.useState(!1);return u.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const s=window.matchMedia(zn);t(s.matches);const i=n=>{t(n.matches)};if(s.addEventListener)return s.addEventListener("change",i),()=>{s.removeEventListener("change",i)};if(s.addListener)return s.addListener(i),()=>{s.removeListener(i)}},[]),e}var On=es["useId".toString()]||(()=>{});function In(){return On()??""}var Ln=typeof window<"u"?u.useLayoutEffect:u.useEffect,We=!1,kn=0,ot=()=>++kn;function Hn(e){const t=e||(We?ot():null),[s,i]=u.useState(t);return Ln(()=>{s===null&&i(ot())},[]),u.useEffect(()=>{We===!1&&(We=!0)},[]),s!=null?String(s):void 0}function Un(e){const t=In(),s=Hn(e);return typeof e=="string"?e:typeof t=="string"?t:s}function Fn(e,t){const s=performance.now(),i={};function n(){i.id=requestAnimationFrame(r=>{r-s>t?e():n()})}return n(),i}function lt(e){e.id&&cancelAnimationFrame(e.id)}function ct(e){return e!=null&&e.current?e.current.scrollHeight:(we(!0,"Was not able to find a ref to the collapse element via `getCollapseProps`. Ensure that the element exposes its `ref` prop. If it exposes the ref prop under a different name (like `innerRef`), use the `refKey` property to change it. Example:\n\nconst collapseProps = getCollapseProps({refKey: 'innerRef'})"),0)}function Gn(e){if(!e||typeof e=="string")return 0;const t=e/36;return Math.round((4+15*t**.25+t/5)*10)}function Vn(e,t){if(e!=null)if(typeof e=="function")e(t);else try{e.current=t}catch{throw new Bn(`Cannot assign value "${t}" to ref "${e}"`)}}function ut(...e){return e.every(t=>t==null)?null:t=>{e.forEach(s=>{Vn(s,t)})}}function $n(e){let t=s=>{};t=s=>{if(!(s!=null&&s.current))return;const{paddingTop:i,paddingBottom:n}=window.getComputedStyle(s.current);we(!(i&&i!=="0px"||n&&n!=="0px"),`Padding applied to the collapse element will cause the animation to break and not perform as expected. To fix, apply equivalent padding to the direct descendent of the collapse element. Example:

Before:   <div {...getCollapseProps({style: {padding: 10}})}>{children}</div>

After:   <div {...getCollapseProps()}>
             <div style={{padding: 10}}>
                 {children}
             </div>
          </div>`)},u.useEffect(()=>{t(e)},[e])}var jn=typeof window>"u"?u.useEffect:u.useLayoutEffect;function Wn({duration:e,easing:t="cubic-bezier(0.4, 0, 0.2, 1)",onTransitionStateChange:s=()=>{},isExpanded:i,defaultExpanded:n=!1,hasDisabledAnimation:r,id:a,...l}={}){const c=Pt(s),h=Un(a?`${a}`:void 0),[v,y]=Nn(i,n),S=u.useRef(v),[x,C]=u.useState(!1),B=Dn(),E=r??B,T=u.useRef(),m=u.useRef(),b=u.useRef(null),[A,I]=u.useState(null);$n(b);const U=`${l.collapsedHeight||0}px`;function k(o){if(!b.current)return;const d=b.current;for(const f in o){const N=o[f];N?d.style[f]=N:d.style.removeProperty(f)}}return jn(()=>{if(!b.current||v===S.current)return;S.current=v;function d(O){return E?0:e??Gn(O)}const f=O=>`height ${d(O)}ms ${t}`,N=O=>{function W(){v?(k({height:"",overflow:"",transition:"",display:""}),c("expandEnd")):(k({transition:""}),c("collapseEnd")),C(!1)}m.current&&lt(m.current),m.current=Fn(W,O)};return C(!0),v?T.current=requestAnimationFrame(()=>{c("expandStart"),k({display:"block",overflow:"hidden",height:U}),T.current=requestAnimationFrame(()=>{c("expanding");const O=ct(b);N(d(O)),b.current&&(b.current.style.transition=f(O),b.current.style.height=`${O}px`)})}):T.current=requestAnimationFrame(()=>{c("collapseStart");const O=ct(b);N(d(O)),k({transition:f(O),height:`${O}px`}),T.current=requestAnimationFrame(()=>{c("collapsing"),k({height:U,overflow:"hidden"})})}),()=>{T.current&&cancelAnimationFrame(T.current),m.current&&lt(m.current)}},[v,U,E,e,t,c]),{isExpanded:v,setExpanded:y,getToggleProps(o){const{disabled:d,onClick:f,refKey:N,...O}={refKey:"ref",onClick(){},disabled:!1,...o},W=A?A.tagName==="BUTTON":void 0,re=o==null?void 0:o[N||"ref"],fe={id:`react-collapsed-toggle-${h}`,"aria-controls":`react-collapsed-panel-${h}`,"aria-expanded":v,onClick(ze){d||(f==null||f(ze),y(De=>!De))},[N||"ref"]:ut(re,I)},ye={type:"button",disabled:d?!0:void 0},H={"aria-disabled":d?!0:void 0,role:"button",tabIndex:d?-1:0};return W===!1?{...fe,...H,...O}:W===!0?{...fe,...ye,...O}:{...fe,...ye,...H,...O}},getCollapseProps(o){const{style:d,refKey:f}={refKey:"ref",style:{},...o},N=o==null?void 0:o[f||"ref"];return{id:`react-collapsed-panel-${h}`,"aria-hidden":!v,"aria-labelledby":`react-collapsed-toggle-${h}`,role:"region",...o,[f||"ref"]:ut(b,N),style:{boxSizing:"border-box",...!x&&!v?{display:U==="0px"?"none":"block",height:U,overflow:"hidden"}:{},...d}}}}}var Bt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},dt=X.createContext&&X.createContext(Bt),Kn=["attr","size","title"];function Xn(e,t){if(e==null)return{};var s=Zn(e,t),i,n;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function Zn(e,t){if(e==null)return{};var s={},i=Object.keys(e),n,r;for(r=0;r<i.length;r++)n=i[r],!(t.indexOf(n)>=0)&&(s[n]=e[n]);return s}function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},Ae.apply(this,arguments)}function ht(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),s.push.apply(s,i)}return s}function Me(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ht(Object(s),!0).forEach(function(i){qn(e,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ht(Object(s)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(s,i))})}return e}function qn(e,t,s){return t=Yn(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Yn(e){var t=Qn(e,"string");return typeof t=="symbol"?t:String(t)}function Qn(e,t){if(typeof e!="object"||e===null)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var i=s.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Nt(e){return e&&e.map((t,s)=>X.createElement(t.tag,Me({key:s},t.attr),Nt(t.child)))}function xe(e){return t=>X.createElement(Jn,Ae({attr:Me({},e.attr)},t),Nt(e.child))}function Jn(e){var t=s=>{var{attr:i,size:n,title:r}=e,a=Xn(e,Kn),l=n||s.size||"1em",c;return s.className&&(c=s.className),e.className&&(c=(c?c+" ":"")+e.className),X.createElement("svg",Ae({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,i,a,{className:c,style:Me(Me({color:e.color||s.color},s.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),r&&X.createElement("title",null,r),e.children)};return dt!==void 0?X.createElement(dt.Consumer,null,s=>t(s)):t(Bt)}function ft(e){return xe({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"},child:[]},{tag:"path",attr:{d:"M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7-21.2 8.1-39.2 22.3-52.1 40.9-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0 1 30.9-44.8c59-22.7 97.1-74.7 97.1-132.5.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1 0 80 0 40 40 0 1 0-80 0z"},child:[]}]})(e)}function er(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m18.25 7.6-5.5-3.18a1.49 1.49 0 0 0-1.5 0L5.75 7.6c-.46.27-.75.76-.75 1.3v6.35c0 .54.29 1.03.75 1.3l5.5 3.18c.46.27 1.04.27 1.5 0l5.5-3.18c.46-.27.75-.76.75-1.3V8.9c0-.54-.29-1.03-.75-1.3zM7 14.96v-4.62l4 2.32v4.61l-4-2.31zm5-4.03L8 8.61l4-2.31 4 2.31-4 2.32zm1 6.34v-4.61l4-2.32v4.62l-4 2.31zM7 2H3.5C2.67 2 2 2.67 2 3.5V7h2V4h3V2zm10 0h3.5c.83 0 1.5.67 1.5 1.5V7h-2V4h-3V2zM7 22H3.5c-.83 0-1.5-.67-1.5-1.5V17h2v3h3v2zm10 0h3.5c.83 0 1.5-.67 1.5-1.5V17h-2v3h-3v2z"},child:[]}]})(e)}function tr(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"},child:[]}]})(e)}function sr(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M24 24H0V0h24v24z",opacity:".87"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"},child:[]}]})(e)}let me=1,zt=new Array,le=new Array;Ye.get("https://sheets.googleapis.com/v4/spreadsheets/18hHq4XYLPYSN1Wc0RjY5zl5vCHoVVrlugpG-O7cULLw/values/Workbook?key=AIzaSyCqcO7MQv4dsj76ps3nNJnMwTT8Cvqv-eM").then(e=>{let t=e.data.values,s=new Array;for(const i of t)me>2&&i[1]!=""&&(zt.push(s),s=new Array),s.push(i),++me});function ir(){const[e,t]=u.useState(),[s,i]=u.useState(),[n,r]=u.useState(),a=se(x=>x.isNotVisibleToggle),l=se(x=>x.isVisibleToggle);se(x=>x.isVisible);let{stepCount:c,howToData:h,setHowToWorkbook:v,setClickedPath:y,path:S}=u.useContext(K);return u.useEffect(()=>{let x=new Array;Ye.get("https://sheets.googleapis.com/v4/spreadsheets/1grTucZ2sqLgZ4AtJq8EkyO__kLg-pazRVl3sbLNMaIY/values/Blad1?key=AIzaSyCqcO7MQv4dsj76ps3nNJnMwTT8Cvqv-eM").then(C=>{let B=C.data.values,E=new Array,T=[];for(const m of B)me>0&&m[0]!=""?(E=new Array,E.push(m),x.push(E)):E.push(m),++me;v(x);for(const m of x)m[0]!=""&&(le=new Array,le.push(m[0][0],m[0][1]),T.push(le));r(T)})},[]),u.useEffect(()=>{let x=new Array;for(const C of zt[c+1])C[12]!=""&&C[12]!=null&&(le=new Array,le.push(C[12]),x.push(le)),++me;t(x)},[c]),u.useEffect(()=>{let x=[];if(n!=null){for(const C of e)for(const B of n)B.includes(`${C}`)&&x.push(B);i(x),e.length===0?a():l()}},[n,e]),console.log(S),p(G,{children:p("div",{children:p("ul",{children:s?s.map((x,C)=>z("li",{children:[p(ts,{to:`/HowTo/${x[0]}`,target:"_blank",rel:"noopener noreferrer",children:z("button",{type:"button",className:"stepNaviBtn",children:[x[0],". ",x[1]]})})," "]},C)):null})})})}function nr(){const e=u.useRef(),[t,s]=u.useState(!1),{getCollapseProps:i,getToggleProps:n}=Wn({isExpanded:t}),r=se(a=>a.isVisible);return z(G,{children:[p("button",{type:"button",...n({onClick:()=>s(a=>!a)}),className:t?"expanded":"btn",style:{position:"absolute",top:"20px",left:"20px",visibility:`${r}`},children:t?z(G,{children:[p(ft,{})," How To ",p(tr,{})]}):z(G,{children:[p(ft,{})," How To ",p(sr,{})]})}),p("div",{ref:e,className:"howToBoxContent",...i(),children:p(ir,{})})]})}function rr(e){return xe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"line",attr:{x1:"12",x2:"12",y1:"8",y2:"12"},child:[]},{tag:"line",attr:{x1:"12",x2:"12.01",y1:"16",y2:"16"},child:[]}]})(e)}function ar(){let{visibleObj:e}=u.useContext(K);const t=se(l=>l.cameraPositionTag),s=se(l=>l.freeControls),i=Tt(),[n]=u.useState(()=>new Y),[r]=u.useState(()=>new Y),a=new Y(4,.5,8);return bt((l,c)=>{t==="initial"&&(n.lerp(a,.1),r.lerp([0,0,0],.1),l.camera.position.copy(n),l.camera.lookAt(r),s(),i.refresh(e).fit())}),p(G,{})}function vr(){const e=ce("./Fabulaser_V3_All_In.glb"),t=ce("./Fabulaser_V3_All_Out.glb"),s=u.useMemo(()=>e.scene.clone(),[e]);ce.clear("./Fabulaser_V3_All_In.glb"),ce.clear("./Fabulaser_V3_All_Out.glb");const i=se(r=>r.resetCamera);function n(){const{active:r,progress:a,errors:l,item:c,loaded:h,total:v}=ns();return z(Html,{center:!0,children:[a," % loaded"]})}return p(G,{children:z(u.Fragment,{children:[p("aside",{className:"stepNavi",children:p(wn,{})}),z("section",{id:"currentStepArea",children:[z("nav",{className:"currentStepBar",children:[p("h2",{id:"stepTitleArea",children:p(Cn,{})}),z("div",{id:"stepControl",children:[p(as,{}),"                        "]})]}),z("div",{className:"infoColumn",children:[p("div",{className:"stepPartsArea",children:p(ls,{})}),z("div",{className:"stepRemarksArea",children:[z("div",{style:{margin:"auto",display:"inline",alignContent:"baseline"},children:[z("h3",{children:[" ",p(rr,{})," Remarks"]})," ",p("br",{})]}),p(Pn,{})]})]}),z("article",{className:"viewArea",children:[p(u.Suspense,{fallback:p(n,{}),children:z(ss,{linear:!0,flat:!0,frameloop:"demand",camera:{fov:45,near:.1,far:1e3,position:[4,.5,8]},children:[p(or,{}),p("color",{args:["#f5f5f5"],attach:"background"}),p("directionalLight",{position:[1,2,3],intensity:10}),p("ambientLight",{intensity:10}),z(is,{clip:!0,observe:!0,damping:2,margin:.85,children:[p(_n,{modelIn:e,modelOut:t,modelInCopy:s}),p(Rn,{})]}),p(ar,{})]})}),z("button",{className:"btn",style:{position:"absolute",bottom:"20px",left:"20px"},onClick:i,children:[p(er,{})," Reset Camera"]}),p(os,{}),p(nr,{})]}),p("div",{className:"backgroundLoad",children:z("p",{children:["Please wait a moment, ",p("br",{}),"the model is being prepared."]})})]})]})})}ce.preload("./Fabulaser_V3_All_In.glb");ce.preload("./Fabulaser_V3_All_Out.glb");function or(){const e=u.useRef();return p(G,{children:p(rs,{ref:e,makeDefault:!0,enableDamping:!1,enableRotate:!0,minAzimuthAngle:1/0,maxAzimuthAngle:1/0,minPolarAngle:0,maxPolarAngle:1/0})})}export{vr as default};
//# sourceMappingURL=App-e59ad257.js.map
